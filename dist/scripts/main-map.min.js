(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var toArray = exports.toArray = function toArray(arrayLike) {
  if (Array.isArray(arrayLike)) {
    return arrayLike;
  }

  if (arrayLike instanceof Node) {
    return [arrayLike];
  }

  return Array.prototype.slice.call(arrayLike);
};

var $ = exports.$ = function $(selector) {
  var context = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : document;
  return toArray(context.querySelectorAll.call(context, selector));
};

var selector = exports.selector = function selector(block, elem, modName, modVal) {
  return block + '__' + elem + (modName ? modVal ? '_' + modName + '_' + modVal : '_' + modName : '');
};

var buildClass = exports.buildClass = function buildClass() {
  return '.' + selector.apply(undefined, arguments);
};

var BEM = exports.BEM = function (_ref) {
  _inherits(BEM, _ref);

  function BEM(name, node) {
    _classCallCheck(this, BEM);

    var _this = _possibleConstructorReturn(this, (BEM.__proto__ || Object.getPrototypeOf(BEM)).call(this));

    _this.node = node;
    _this.name = name;
    return _this;
  }

  _createClass(BEM, [{
    key: 'elem',
    value: function elem(name, modName, modVal) {
      return this.node.querySelector(buildClass(this.name, name, modName, modVal));
    }
  }, {
    key: 'elems',
    value: function elems(name, modName, modVal) {
      return $(buildClass(this.name, name, modName, modVal), this.node);
    }
  }, {
    key: 'setMod',
    value: function setMod(elem, elemName, modName, modValue) {
      var _this2 = this;

      toArray(elem).forEach(function (node) {
        return node.classList.add(selector(_this2.name, elemName, modName, modValue));
      });

      return this;
    }
  }, {
    key: 'delMod',
    value: function delMod(elem, elemName, modName) {
      var _this3 = this;

      toArray(elem).forEach(function (node) {
        return node.classList.remove(selector(_this3.name, elemName, modName));
      });

      return this;
    }
  }]);

  return BEM;
}(null);

},{}],2:[function(require,module,exports){
'use strict';

var _dom = require('./dom');

var _utils = require('./utils');

var _search = require('./search');

var _search2 = _interopRequireDefault(_search);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

(0, _utils.fetchJSON)('data/search.json').then(function (data) {
  (0, _dom.$)('.search').forEach(function (node) {
    return new _search2.default(node, data);
  });
});

/*var map;
window.initMap = function initMap() {
  map = new google.maps.Map(document.getElementById('map'), {
    center: {lat: 50.4021368, lng: 30.5525107 },
    zoom: 11
  });

  const marker = new google.maps.Marker({
    title: 'Test',
    position: { lat: 50.4021368, lng: 30.5525107 },
    icon: {
      path: google.maps.SymbolPath.CIRCLE,
      scale: 5,
      strokeColor: '#4880ed',
      fillOpacity: 1,
      fillColor: '#4880ed'
    },
    draggable: true,
    map: map
  });

  const infowindow = new google.maps.InfoWindow({
    content: `<b>Test</b>`,
    maxWidth: 200
  });

  marker.addListener('click', () => {
    infowindow.open(map, marker);
  });
};
*/

},{"./dom":1,"./search":3,"./utils":4}],3:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"]) _i["return"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError("Invalid attempt to destructure non-iterable instance"); } }; }();

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _dom = require('./dom');

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var HOVER_DEBOUNCE_TIMEOUT = 200;

var createItem = function createItem(data) {
  var node = document.createElement('li');

  node.classList.add((0, _dom.selector)('search', 'result-item'));
  node.innerHTML = '\n    <div class="search__result-item-title">\n        ' + data.name + '\n    </div>\n    ' + data.address.settlement + ' <br />\n    ' + data.address.street + ', ' + data.address.building + ' <br />\n    \u0422\u0435\u043B.: ' + data.phones[0].number + ' <br />\n    \u0413\u043E\u0434\u0438\u043D\u0438 \u0440\u043E\u0431\u043E\u0442\u0438: \u041F\u043D-\u041F\u0442, 9:00-19:00\n  ';

  return node;
};

var getTooltipContent = function getTooltipContent(data) {
  return '<div class="search__map-tooltip">\n    <b>' + data.name + '</b> <br />\n    ' + data.address.settlement + ' <br />\n    ' + data.address.street + ', ' + data.address.building + ' <br />\n    \u0422\u0435\u043B.: ' + data.phones[0].number + ' <br />\n    \n    <div class="search__map-tooltip-count">\n        ' + data.doctors + '\n        <small>\u043B\u0456\u043A\u0430\u0440\u0456\u0432</small>\n    </div>\n    <div class="search__map-tooltip-count">\n        ' + data.declarations + '\n        <small>\u0434\u0435\u043A\u043B\u0430\u0440\u0430\u0446\u0456\u0439 \u043F\u0456\u0434\u043F\u0438\u0441\u0430\u043D\u043E</small>\n    </div>\n  </div>';
};

var Search = function (_BEM) {
  _inherits(Search, _BEM);

  function Search(node, data) {
    _classCallCheck(this, Search);

    var _this = _possibleConstructorReturn(this, (Search.__proto__ || Object.getPrototypeOf(Search)).call(this, 'search', node));

    _this.markers = [];
    _this.$markerNodes = [];
    _this.timeout = null;


    _this.$result = _this.elem('result');

    _this.data = data;
    _this.map = new google.maps.Map(_this.elem('map'), {
      center: { lat: 50.4021368, lng: 30.4525107 },
      zoom: 11
    });

    _this.tooltip = new google.maps.InfoWindow({
      maxWidth: 250,
      pixelOffset: new google.maps.Size(136, 388),
      zIndex: -2
    });

    var fragment = document.createDocumentFragment();

    _this.data.forEach(function (item, index) {
      var node = createItem(item);

      node.dataset.index = index;
      fragment.appendChild(node);

      var marker = _this.createMarker(item.address.coordinates);
      _this.markers.push(marker);
      _this.$markerNodes.push(node);

      marker.addListener('click', function () {
        return _this.setActive(index);
      });
      marker.addListener('mouseover', function (_ref) {
        var ta = _ref.ta;

        _this.onHoverMarker(index, 'over', ta.target);
      });
      marker.addListener('mouseout', function () {
        return _this.onHoverMarker(index, 'out');
      });
    });

    _this.$result.appendChild(fragment);

    _this.$result.addEventListener('click', function (_ref2) {
      var target = _ref2.target;

      var $item = target.closest((0, _dom.buildClass)(_this.name, 'result-item'));

      if ($item === null) {
        return;
      }

      _this.map.setCenter({
        lat: _this.data[$item.dataset.index].address.coordinates[0],
        lng: _this.data[$item.dataset.index].address.coordinates[1]
      });

      _this.map.setZoom(11);

      _this.setActive($item.dataset.index);
    }, false);

    _this.activeMarker = new google.maps.Marker({
      map: _this.map,
      zIndex: 2,
      icon: {
        url: 'images/icons/marker.png',
        scaledSize: new google.maps.Size(33, 47),
        anchor: new google.maps.Point(17, 60)
      }
    });
    return _this;
  }

  _createClass(Search, [{
    key: 'onHoverMarker',
    value: function onHoverMarker(index, type) {
      var _this2 = this;

      clearTimeout(this.timeout);
      this.timeout = setTimeout(function () {
        switch (type) {
          case 'over':
            _this2.showTooltip(index);
            break;
          case 'out':
            _this2.hideTooltip();
            break;
        }
      }, HOVER_DEBOUNCE_TIMEOUT);
    }
  }, {
    key: 'hideTooltip',
    value: function hideTooltip() {
      var _this3 = this;

      var node = this.$tooltipNode;

      if (!node) {
        return;
      }

      var player = node.animate([{ opacity: 1, transform: 'translateY(0)' }, { opacity: 0, transform: 'translateY(-20px)' }], this.constructor.ANIMATION_OPTIONS);

      var marker = this.hoverMarker;
      var size = 20;
      requestAnimationFrame(function animate() {
        if (size <= 0) {
          marker.setMap(null);
          return;
        }

        marker.setIcon(_extends({}, marker.getIcon(), { scale: size }));
        size = size - 2;
        requestAnimationFrame(animate);
      });

      player.onfinish = function () {
        _this3.tooltip.close();
      };

      this.activeIndex = -1;
    }
  }, {
    key: 'showTooltip',
    value: function showTooltip(index) {
      var _this4 = this;

      if (index === this.activeIndex) {
        return;
      }

      this.tooltip.setContent(getTooltipContent(this.data[index]));
      this.tooltip.open(this.map, this.markers[index]);

      var node = this.$tooltipNode = this.tooltipNode.parentNode;
      node.removeChild(node.firstChild);
      node.removeChild(node.lastChild);

      node.addEventListener('mouseover', function () {
        clearTimeout(_this4.timeout);
      }, false);

      node.addEventListener('mouseout', function () {
        _this4.onHoverMarker(index, 'out');
      }, false);

      if (this.hoverMarker) {
        this.hoverMarker.setMap(null);
      }

      var marker = this.hoverMarker = new google.maps.Marker({
        position: {
          lat: this.data[index].address.coordinates[0],
          lng: this.data[index].address.coordinates[1]
        },
        zIndex: -2,
        icon: {
          path: google.maps.SymbolPath.CIRCLE,
          scale: 0,
          strokeColor: '#4880ed',
          fillOpacity: 1,
          fillColor: '#4880ed'
        },
        opacity: .1,
        draggable: true,
        map: this.map
      });

      this.activeIndex = index;

      marker.addListener('mouseover', function () {
        _this4.onHoverMarker(index, 'over');
      });

      marker.addListener('mouseout', function () {
        _this4.onHoverMarker(index, 'out');
      });

      var size = 0;
      requestAnimationFrame(function animate() {
        if (size >= 20) {
          return;
        }

        marker.setIcon(_extends({}, marker.getIcon(), { scale: size }));
        size = size + 2;
        requestAnimationFrame(animate);
      });

      if (index === this.activeMarkerIndex) {
        this.tooltipNode.animate([{ opacity: 0, transform: 'translateY(0px)' }, { opacity: 1, transform: 'translateY(10px)' }], this.constructor.ANIMATION_OPTIONS);
      } else {
        this.tooltipNode.animate([{ opacity: 0, transform: 'translateY(-20px)' }, { opacity: 1, transform: 'translateY(0)' }], this.constructor.ANIMATION_OPTIONS);
      }
    }
  }, {
    key: 'setActive',
    value: function setActive(index) {
      if (index === this.activeMarkerIndex) {
        return;
      }

      var address = this.data[index].address;

      var $item = this.$markerNodes[index];

      if (index === this.activeIndex) {
        this.tooltipNode.style.top = '18px';
      }

      if (this.$active) {
        this.delMod(this.$active, 'result-item', 'active');
        this.markers[this.$active.dataset.index].setIcon(this.defaultMarkerIcon);
      }

      this.setMod($item, 'result-item', 'active');
      this.$active = $item;
      this.activeMarkerIndex = Number(index);

      this.markers[$item.dataset.index].setIcon(this.activeMarkerIcon);

      this.activeMarker.setPosition({ lat: address.coordinates[0], lng: address.coordinates[1] });
    }
  }, {
    key: 'createMarker',
    value: function createMarker(_ref3) {
      var _ref4 = _slicedToArray(_ref3, 2),
          lat = _ref4[0],
          lng = _ref4[1];

      return new google.maps.Marker({
        position: { lat: lat, lng: lng },
        zIndex: -1,
        icon: this.defaultMarkerIcon,
        draggable: false,
        map: this.map
      });
    }
  }, {
    key: 'defaultMarkerIcon',
    get: function get() {
      return {
        path: google.maps.SymbolPath.CIRCLE,
        scale: 4,
        strokeColor: '#4880ed',
        fillOpacity: 1,
        fillColor: '#4880ed'
      };
    }
  }, {
    key: 'activeMarkerIcon',
    get: function get() {
      return {
        path: google.maps.SymbolPath.CIRCLE,
        scale: 8,
        strokeColor: '#4880ed',
        fillOpacity: 1,
        fillColor: '#ffffff',
        strokeWeight: 6
      };
    }
  }, {
    key: 'tooltipNode',
    get: function get() {
      return document.querySelector('.gm-style-iw');
    }
  }]);

  return Search;
}(_dom.BEM);

Search.ANIMATION_OPTIONS = {
  duration: 200,
  fill: 'forwards',
  easing: 'ease-in-out'
};
exports.default = Search;
module.exports = exports['default'];

},{"./dom":1}],4:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
var objectToQuery = function objectToQuery(target) {
  return '?' + Object.keys(target).reduce(function (arr, key) {
    return arr.push(key + '=' + target[key]) && arr;
  }, []).join('&');
};

var numberFormatting = exports.numberFormatting = function numberFormatting(number) {
  return number.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1 ').split('.')[0];
};

var fetchJSON = exports.fetchJSON = function fetchJSON(url) {
  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : { method: 'GET' };
  return new Promise(function (resolve, reject) {
    var request = new XMLHttpRequest();

    if (options.body && options.method === 'GET') {
      url += objectToQuery(options.body);
    }

    request.onreadystatechange = function () {
      if (request.readyState !== 4) {
        return;
      }

      resolve(JSON.parse(request.responseText));
    };

    request.onerror = reject;
    request.open(options.method || 'GET', url);
    request.send(options.body ? JSON.stringify(options.body) : null);
  });
};

},{}]},{},[2])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvc2NyaXB0cy9kb20uanMiLCJzcmMvc2NyaXB0cy9tYWluLW1hcC5qcyIsInNyYy9zY3JpcHRzL3NlYXJjaC5qcyIsInNyYy9zY3JpcHRzL3V0aWxzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7Ozs7Ozs7QUNBTyxJQUFNLDRCQUFVLFNBQVYsT0FBVSxZQUFhO0FBQ2xDLE1BQUksTUFBTSxPQUFOLENBQWMsU0FBZCxDQUFKLEVBQThCO0FBQzVCLFdBQU8sU0FBUDtBQUNEOztBQUVELE1BQUkscUJBQXFCLElBQXpCLEVBQStCO0FBQzdCLFdBQU8sQ0FBQyxTQUFELENBQVA7QUFDRDs7QUFFRCxTQUFPLE1BQU0sU0FBTixDQUFnQixLQUFoQixDQUFzQixJQUF0QixDQUEyQixTQUEzQixDQUFQO0FBQ0QsQ0FWTTs7QUFZQSxJQUFNLGdCQUFJLFNBQUosQ0FBSSxDQUFDLFFBQUQ7QUFBQSxNQUFXLE9BQVgsdUVBQXFCLFFBQXJCO0FBQUEsU0FDZixRQUFRLFFBQVEsZ0JBQVIsQ0FBeUIsSUFBekIsQ0FBOEIsT0FBOUIsRUFBdUMsUUFBdkMsQ0FBUixDQURlO0FBQUEsQ0FBVjs7QUFJQSxJQUFNLDhCQUFXLFNBQVgsUUFBVyxDQUFDLEtBQUQsRUFBUSxJQUFSLEVBQWMsT0FBZCxFQUF1QixNQUF2QjtBQUFBLFNBQ25CLEtBRG1CLFVBQ1QsSUFEUyxJQUNGLFVBQVcsZUFBYSxPQUFiLFNBQXdCLE1BQXhCLFNBQXVDLE9BQWxELEdBQStELEVBRDdEO0FBQUEsQ0FBakI7O0FBSUEsSUFBTSxrQ0FBYSxTQUFiLFVBQWE7QUFBQSxlQUFpQixvQ0FBakI7QUFBQSxDQUFuQjs7SUFFTSxHLFdBQUEsRzs7O0FBQ1gsZUFBWSxJQUFaLEVBQWtCLElBQWxCLEVBQXdCO0FBQUE7O0FBQUE7O0FBRXRCLFVBQUssSUFBTCxHQUFZLElBQVo7QUFDQSxVQUFLLElBQUwsR0FB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Q0FBUDtBQUNEOztBQUVELFlBQVEsa0JBQVIsR0FBNkIsWUFBTTtBQUNqQyxVQUFJLFFBQVEsVUFBUixLQUF1QixDQUEzQixFQUE4QjtBQUM1QjtBQUNEOztBQUVELGNBQVEsS0FBSyxLQUFMLENBQVcsUUFBUSxZQUFuQixDQUFSO0FBQ0QsS0FORDs7QUFRQSxZQUFRLE9BQVIsR0FBa0IsTUFBbEI7QUFDQSxZQUFRLElBQVIsQ0FBYSxRQUFRLE1BQVIsSUFBa0IsS0FBL0IsRUFBc0MsR0FBdEM7QUFDQSxZQUFRLElBQVIsQ0FBYSxRQUFRLElBQVIsR0FBZSxLQUFLLFNBQUwsQ0FBZSxRQUFRLElBQXZCLENBQWYsR0FBOEMsSUFBM0Q7QUFDRCxHQWxCOEQsQ0FBdEM7QUFBQSxDQUFsQiIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCJleHBvcnQgY29uc3QgdG9BcnJheSA9IGFycmF5TGlrZSA9PiB7XG4gIGlmIChBcnJheS5pc0FycmF5KGFycmF5TGlrZSkpIHtcbiAgICByZXR1cm4gYXJyYXlMaWtlO1xuICB9XG5cbiAgaWYgKGFycmF5TGlrZSBpbnN0YW5jZW9mIE5vZGUpIHtcbiAgICByZXR1cm4gW2FycmF5TGlrZV07XG4gIH1cblxuICByZXR1cm4gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJyYXlMaWtlKTtcbn07XG5cbmV4cG9ydCBjb25zdCAkID0gKHNlbGVjdG9yLCBjb250ZXh0ID0gZG9jdW1lbnQpID0+IChcbiAgdG9BcnJheShjb250ZXh0LnF1ZXJ5U2VsZWN0b3JBbGwuY2FsbChjb250ZXh0LCBzZWxlY3RvcikpXG4pO1xuXG5leHBvcnQgY29uc3Qgc2VsZWN0b3IgPSAoYmxvY2ssIGVsZW0sIG1vZE5hbWUsIG1vZFZhbCkgPT4gKFxuICBgJHtibG9ja31fXyR7ZWxlbX0ke21vZE5hbWUgPyAobW9kVmFsID8gYF8ke21vZE5hbWV9XyR7bW9kVmFsfWAgOiBgXyR7bW9kTmFtZX1gKSA6ICcnfWBcbik7XG5cbmV4cG9ydCBjb25zdCBidWlsZENsYXNzID0gKC4uLmFyZ3MpID0+IGAuJHtzZWxlY3RvciguLi5hcmdzKX1gO1xuXG5leHBvcnQgY2xhc3MgQkVNIGV4dGVuZHMgbnVsbCB7XG4gIGNvbnN0cnVjdG9yKG5hbWUsIG5vZGUpIHtcbiAgICBzdXBlcigpO1xuICAgIHRoaXMubm9kZSA9IG5vZGU7XG4gICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgfVxuXG4gIGVsZW0obmFtZSwgbW9kTmFtZSwgbW9kVmFsKSB7XG4gICAgcmV0dXJuIHRoaXMubm9kZS5xdWVyeVNlbGVjdG9yKGJ1aWxkQ2xhc3ModGhpcy5uYW1lLCBuYW1lLCBtb2ROYW1lLCBtb2RWYWwpKTtcbiAgfVxuXG4gIGVsZW1zKG5hbWUsIG1vZE5hbWUsIG1vZFZhbCkge1xuICAgIHJldHVybiAkKGJ1aWxkQ2xhc3ModGhpcy5uYW1lLCBuYW1lLCBtb2ROYW1lLCBtb2RWYWwpLCB0aGlzLm5vZGUpO1xuICB9XG5cbiAgc2V0TW9kKGVsZW0sIGVsZW1OYW1lLCBtb2ROYW1lLCBtb2RWYWx1ZSkge1xuICAgIHRvQXJyYXkoZWxlbSkuZm9yRWFjaChub2RlID0+IChcbiAgICAgIG5vZGUuY2xhc3NMaXN0LmFkZChzZWxlY3Rvcih0aGlzLm5hbWUsIGVsZW1OYW1lLCBtb2ROYW1lLCBtb2RWYWx1ZSkpXG4gICAgKSk7XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIGRlbE1vZChlbGVtLCBlbGVtTmFtZSwgbW9kTmFtZSkge1xuICAgIHRvQXJyYXkoZWxlbSkuZm9yRWFjaChub2RlID0+IChcbiAgICAgIG5vZGUuY2xhc3NMaXN0LnJlbW92ZShzZWxlY3Rvcih0aGlzLm5hbWUsIGVsZW1OYW1lLCBtb2ROYW1lKSlcbiAgICApKTtcblxuICAgIHJldHVybiB0aGlzO1xuICB9XG59IiwiaW1wb3J0IHsgJCB9IGZyb20gJy4vZG9tJztcbmltcG9ydCB7IGZldGNoSlNPTiB9IGZyb20gJy4vdXRpbHMnO1xuXG5pbXBvcnQgU2VhcmNoIGZyb20gJy4vc2VhcmNoJztcblxuZmV0Y2hKU09OKCdkYXRhL3NlYXJjaC5qc29uJykudGhlbihkYXRhID0+IHtcbiAgJCgnLnNlYXJjaCcpLmZvckVhY2gobm9kZSA9PiBuZXcgU2VhcmNoKG5vZGUsIGRhdGEpKTtcbn0pO1xuXG5cbi8qdmFyIG1hcDtcbndpbmRvdy5pbml0TWFwID0gZnVuY3Rpb24gaW5pdE1hcCgpIHtcbiAgbWFwID0gbmV3IGdvb2dsZS5tYXBzLk1hcChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFwJyksIHtcbiAgICBjZW50ZXI6IHtsYXQ6IDUwLjQwMjEzNjgsIGxuZzogMzAuNTUyNTEwNyB9LFxuICAgIHpvb206IDExXG4gIH0pO1xuXG4gIGNvbnN0IG1hcmtlciA9IG5ldyBnb29nbGUubWFwcy5NYXJrZXIoe1xuICAgIHRpdGxlOiAnVGVzdCcsXG4gICAgcG9zaXRpb246IHsgbGF0OiA1MC40MDIxMzY4LCBsbmc6IDMwLjU1MjUxMDcgfSxcbiAgICBpY29uOiB7XG4gICAgICBwYXRoOiBnb29nbGUubWFwcy5TeW1ib2xQYXRoLkNJUkNMRSxcbiAgICAgIHNjYWxlOiA1LFxuICAgICAgc3Ryb2tlQ29sb3I6ICcjNDg4MGVkJyxcbiAgICAgIGZpbGxPcGFjaXR5OiAxLFxuICAgICAgZmlsbENvbG9yOiAnIzQ4ODBlZCdcbiAgICB9LFxuICAgIGRyYWdnYWJsZTogdHJ1ZSxcbiAgICBtYXA6IG1hcFxuICB9KTtcblxuICBjb25zdCBpbmZvd2luZG93ID0gbmV3IGdvb2dsZS5tYXBzLkluZm9XaW5kb3coe1xuICAgIGNvbnRlbnQ6IGA8Yj5UZXN0PC9iPmAsXG4gICAgbWF4V2lkdGg6IDIwMFxuICB9KTtcblxuICBtYXJrZXIuYWRkTGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgIGluZm93aW5kb3cub3BlbihtYXAsIG1hcmtlcik7XG4gIH0pO1xufTtcbiovIiwiaW1wb3J0IHsgQkVNLCBzZWxlY3RvciwgYnVpbGRDbGFzcyB9IGZyb20gJy4vZG9tJztcblxuY29uc3QgSE9WRVJfREVCT1VOQ0VfVElNRU9VVCA9IDIwMDtcblxuY29uc3QgY3JlYXRlSXRlbSA9IChkYXRhKSA9PiB7XG4gIGNvbnN0IG5vZGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xuXG4gIG5vZGUuY2xhc3NMaXN0LmFkZChzZWxlY3Rvcignc2VhcmNoJywgJ3Jlc3VsdC1pdGVtJykpO1xuICBub2RlLmlubmVySFRNTCA9IGBcbiAgICA8ZGl2IGNsYXNzPVwic2VhcmNoX19yZXN1bHQtaXRlbS10aXRsZVwiPlxuICAgICAgICAke2RhdGEubmFtZX1cbiAgICA8L2Rpdj5cbiAgICAke2RhdGEuYWRkcmVzcy5zZXR0bGVtZW50fSA8YnIgLz5cbiAgICAke2RhdGEuYWRkcmVzcy5zdHJlZXR9LCAke2RhdGEuYWRkcmVzcy5idWlsZGluZ30gPGJyIC8+XG4gICAg0KLQtdC7LjogJHtkYXRhLnBob25lc1swXS5udW1iZXJ9IDxiciAvPlxuICAgINCT0L7QtNC40L3QuCDRgNC+0LHQvtGC0Lg6INCf0L0t0J/RgiwgOTowMC0xOTowMFxuICBgO1xuXG4gIHJldHVybiBub2RlO1xufTtcblxuY29uc3QgZ2V0VG9vbHRpcENvbnRlbnQgPSBkYXRhID0+IChcbiAgYDxkaXYgY2xhc3M9XCJzZWFyY2hfX21hcC10b29sdGlwXCI+XG4gICAgPGI+JHtkYXRhLm5hbWV9PC9iPiA8YnIgLz5cbiAgICAke2RhdGEuYWRkcmVzcy5zZXR0bGVtZW50fSA8YnIgLz5cbiAgICAke2RhdGEuYWRkcmVzcy5zdHJlZXR9LCAke2RhdGEuYWRkcmVzcy5idWlsZGluZ30gPGJyIC8+XG4gICAg0KLQtdC7LjogJHtkYXRhLnBob25lc1swXS5udW1iZXJ9IDxiciAvPlxuICAgIFxuICAgIDxkaXYgY2xhc3M9XCJzZWFyY2hfX21hcC10b29sdGlwLWNvdW50XCI+XG4gICAgICAgICR7ZGF0YS5kb2N0b3JzfVxuICAgICAgICA8c21hbGw+0LvRltC60LDRgNGW0LI8L3NtYWxsPlxuICAgIDwvZGl2PlxuICAgIDxkaXYgY2xhc3M9XCJzZWFyY2hfX21hcC10b29sdGlwLWNvdW50XCI+XG4gICAgICAgICR7ZGF0YS5kZWNsYXJhdGlvbnN9XG4gICAgICAgIDxzbWFsbD7QtNC10LrQu9Cw0YDQsNGG0ZbQuSDQv9GW0LTQv9C40YHQsNC90L48L3NtYWxsPlxuICAgIDwvZGl2PlxuICA8L2Rpdj5gXG4pO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBTZWFyY2ggZXh0ZW5kcyBCRU0ge1xuICBtYXJrZXJzID0gW107XG4gICRtYXJrZXJOb2RlcyA9IFtdO1xuXG4gIHRpbWVvdXQgPSBudWxsO1xuXG4gIGNvbnN0cnVjdG9yKG5vZGUsIGRhdGEpIHtcbiAgICBzdXBlcignc2VhcmNoJywgbm9kZSk7XG5cbiAgICB0aGlzLiRyZXN1bHQgPSB0aGlzLmVsZW0oJ3Jlc3VsdCcpO1xuXG4gICAgdGhpcy5kYXRhID0gZGF0YTtcbiAgICB0aGlzLm1hcCA9IG5ldyBnb29nbGUubWFwcy5NYXAodGhpcy5lbGVtKCdtYXAnKSwge1xuICAgICAgY2VudGVyOiB7IGxhdDogNTAuNDAyMTM2OCwgbG5nOiAzMC40NTI1MTA3IH0sXG4gICAgICB6b29tOiAxMVxuICAgIH0pO1xuXG4gICAgdGhpcy50b29sdGlwID0gbmV3IGdvb2dsZS5tYXBzLkluZm9XaW5kb3coe1xuICAgICAgbWF4V2lkdGg6IDI1MCxcbiAgICAgIHBpeGVsT2Zmc2V0OiBuZXcgZ29vZ2xlLm1hcHMuU2l6ZSgxMzYsMzg4KSxcbiAgICAgIHpJbmRleDogLTJcbiAgICB9KTtcblxuICAgIGNvbnN0IGZyYWdtZW50ID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpO1xuXG4gICAgdGhpcy5kYXRhLmZvckVhY2goKGl0ZW0sIGluZGV4KSA9PiB7XG4gICAgICBjb25zdCBub2RlID0gY3JlYXRlSXRlbShpdGVtKTtcblxuICAgICAgbm9kZS5kYXRhc2V0LmluZGV4ID0gaW5kZXg7XG4gICAgICBmcmFnbWVudC5hcHBlbmRDaGlsZChub2RlKTtcblxuICAgICAgY29uc3QgbWFya2VyID0gdGhpcy5jcmVhdGVNYXJrZXIoaXRlbS5hZGRyZXNzLmNvb3JkaW5hdGVzKTtcbiAgICAgIHRoaXMubWFya2Vycy5wdXNoKG1hcmtlcik7XG4gICAgICB0aGlzLiRtYXJrZXJOb2Rlcy5wdXNoKG5vZGUpO1xuXG4gICAgICBtYXJrZXIuYWRkTGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gdGhpcy5zZXRBY3RpdmUoaW5kZXgpKTtcbiAgICAgIG1hcmtlci5hZGRMaXN0ZW5lcignbW91c2VvdmVyJywgKHsgdGEgfSkgPT4ge1xuICAgICAgICB0aGlzLm9uSG92ZXJNYXJrZXIoaW5kZXgsICdvdmVyJywgdGEudGFyZ2V0KTtcbiAgICAgIH0pO1xuICAgICAgbWFya2VyLmFkZExpc3RlbmVyKCdtb3VzZW91dCcsICgpID0+IHRoaXMub25Ib3Zlck1hcmtlcihpbmRleCwgJ291dCcpKTtcbiAgICB9KTtcblxuICAgIHRoaXMuJHJlc3VsdC5hcHBlbmRDaGlsZChmcmFnbWVudCk7XG5cbiAgICB0aGlzLiRyZXN1bHQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoeyB0YXJnZXQgfSkgPT4ge1xuICAgICAgY29uc3QgJGl0ZW0gPSB0YXJnZXQuY2xvc2VzdChidWlsZENsYXNzKHRoaXMubmFtZSwgJ3Jlc3VsdC1pdGVtJykpO1xuXG4gICAgICBpZiAoJGl0ZW0gPT09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICB0aGlzLm1hcC5zZXRDZW50ZXIoe1xuICAgICAgICBsYXQ6IHRoaXMuZGF0YVskaXRlbS5kYXRhc2V0LmluZGV4XS5hZGRyZXNzLmNvb3JkaW5hdGVzWzBdLFxuICAgICAgICBsbmc6IHRoaXMuZGF0YVskaXRlbS5kYXRhc2V0LmluZGV4XS5hZGRyZXNzLmNvb3JkaW5hdGVzWzFdXG4gICAgICB9KTtcblxuICAgICAgdGhpcy5tYXAuc2V0Wm9vbSgxMSk7XG5cbiAgICAgIHRoaXMuc2V0QWN0aXZlKCRpdGVtLmRhdGFzZXQuaW5kZXgpO1xuICAgIH0sIGZhbHNlKTtcblxuICAgIHRoaXMuYWN0aXZlTWFya2VyID0gbmV3IGdvb2dsZS5tYXBzLk1hcmtlcih7XG4gICAgICBtYXA6IHRoaXMubWFwLFxuICAgICAgekluZGV4OiAyLFxuICAgICAgaWNvbjoge1xuICAgICAgICB1cmw6ICdpbWFnZXMvaWNvbnMvbWFya2VyLnBuZycsXG4gICAgICAgIHNjYWxlZFNpemU6IG5ldyBnb29nbGUubWFwcy5TaXplKDMzLCA0NyksXG4gICAgICAgIGFuY2hvcjogbmV3IGdvb2dsZS5tYXBzLlBvaW50KDE3LCA2MCksXG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBvbkhvdmVyTWFya2VyKGluZGV4LCB0eXBlKSB7XG4gICAgY2xlYXJUaW1lb3V0KHRoaXMudGltZW91dCk7XG4gICAgdGhpcy50aW1lb3V0ID0gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICBzd2l0Y2ggKHR5cGUpIHtcbiAgICAgICAgY2FzZSAnb3Zlcic6XG4gICAgICAgICAgdGhpcy5zaG93VG9vbHRpcChpbmRleCk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ291dCc6XG4gICAgICAgICAgdGhpcy5oaWRlVG9vbHRpcCgpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH0sIEhPVkVSX0RFQk9VTkNFX1RJTUVPVVQpO1xuICB9XG5cbiAgaGlkZVRvb2x0aXAoKSB7XG4gICAgY29uc3Qgbm9kZSA9IHRoaXMuJHRvb2x0aXBOb2RlO1xuXG4gICAgaWYgKCFub2RlKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgcGxheWVyID0gbm9kZS5hbmltYXRlKFtcbiAgICAgIHsgb3BhY2l0eTogMSwgdHJhbnNmb3JtOiAndHJhbnNsYXRlWSgwKScgfSxcbiAgICAgIHsgb3BhY2l0eTogMCwgdHJhbnNmb3JtOiAndHJhbnNsYXRlWSgtMjBweCknIH1cbiAgICBdLCB0aGlzLmNvbnN0cnVjdG9yLkFOSU1BVElPTl9PUFRJT05TKTtcblxuICAgIGNvbnN0IG1hcmtlciA9IHRoaXMuaG92ZXJNYXJrZXI7XG4gICAgbGV0IHNpemUgPSAyMDtcbiAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoZnVuY3Rpb24gYW5pbWF0ZSgpIHtcbiAgICAgIGlmIChzaXplIDw9IDApIHtcbiAgICAgICAgbWFya2VyLnNldE1hcChudWxsKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBtYXJrZXIuc2V0SWNvbih7IC4uLm1hcmtlci5nZXRJY29uKCksIHNjYWxlOiBzaXplfSk7XG4gICAgICBzaXplID0gc2l6ZSAtIDI7XG4gICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7XG4gICAgfSk7XG5cbiAgICBwbGF5ZXIub25maW5pc2ggPSAoKSA9PiB7XG4gICAgICB0aGlzLnRvb2x0aXAuY2xvc2UoKTtcbiAgICB9O1xuXG4gICAgdGhpcy5hY3RpdmVJbmRleCA9IC0xO1xuICB9XG5cbiAgc2hvd1Rvb2x0aXAoaW5kZXgpIHtcbiAgICBpZiAoaW5kZXggPT09IHRoaXMuYWN0aXZlSW5kZXgpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLnRvb2x0aXAuc2V0Q29udGVudChnZXRUb29sdGlwQ29udGVudCh0aGlzLmRhdGFbaW5kZXhdKSk7XG4gICAgdGhpcy50b29sdGlwLm9wZW4odGhpcy5tYXAsIHRoaXMubWFya2Vyc1tpbmRleF0pO1xuXG4gICAgY29uc3Qgbm9kZSA9IHRoaXMuJHRvb2x0aXBOb2RlID0gdGhpcy50b29sdGlwTm9kZS5wYXJlbnROb2RlO1xuICAgIG5vZGUucmVtb3ZlQ2hpbGQobm9kZS5maXJzdENoaWxkKTtcbiAgICBub2RlLnJlbW92ZUNoaWxkKG5vZGUubGFzdENoaWxkKTtcblxuICAgIG5vZGUuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VvdmVyJywgKCkgPT4ge1xuICAgICAgY2xlYXJUaW1lb3V0KHRoaXMudGltZW91dCk7XG4gICAgfSwgZmFsc2UpO1xuXG4gICAgbm9kZS5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW91dCcsICgpID0+IHtcbiAgICAgIHRoaXMub25Ib3Zlck1hcmtlcihpbmRleCwgJ291dCcpO1xuICAgIH0sIGZhbHNlKTtcblxuICAgIGlmICh0aGlzLmhvdmVyTWFya2VyKSB7XG4gICAgICB0aGlzLmhvdmVyTWFya2VyLnNldE1hcChudWxsKTtcbiAgICB9XG5cbiAgICBjb25zdCBtYXJrZXIgPSB0aGlzLmhvdmVyTWFya2VyID0gbmV3IGdvb2dsZS5tYXBzLk1hcmtlcih7XG4gICAgICBwb3NpdGlvbjoge1xuICAgICAgICBsYXQ6IHRoaXMuZGF0YVtpbmRleF0uYWRkcmVzcy5jb29yZGluYXRlc1swXSxcbiAgICAgICAgbG5nOiB0aGlzLmRhdGFbaW5kZXhdLmFkZHJlc3MuY29vcmRpbmF0ZXNbMV1cbiAgICAgIH0sXG4gICAgICB6SW5kZXg6IC0yLFxuICAgICAgaWNvbjoge1xuICAgICAgICBwYXRoOiBnb29nbGUubWFwcy5TeW1ib2xQYXRoLkNJUkNMRSxcbiAgICAgICAgc2NhbGU6IDAsXG4gICAgICAgIHN0cm9rZUNvbG9yOiAnIzQ4ODBlZCcsXG4gICAgICAgIGZpbGxPcGFjaXR5OiAxLFxuICAgICAgICBmaWxsQ29sb3I6ICcjNDg4MGVkJ1xuICAgICAgfSxcbiAgICAgIG9wYWNpdHk6IC4xLFxuICAgICAgZHJhZ2dhYmxlOiB0cnVlLFxuICAgICAgbWFwOiB0aGlzLm1hcFxuICAgIH0pO1xuXG4gICAgdGhpcy5hY3RpdmVJbmRleCA9IGluZGV4O1xuXG4gICAgbWFya2VyLmFkZExpc3RlbmVyKCdtb3VzZW92ZXInLCAoKSA9PiB7XG4gICAgICB0aGlzLm9uSG92ZXJNYXJrZXIoaW5kZXgsICdvdmVyJyk7XG4gICAgfSk7XG5cbiAgICBtYXJrZXIuYWRkTGlzdGVuZXIoJ21vdXNlb3V0JywgKCkgPT4ge1xuICAgICAgdGhpcy5vbkhvdmVyTWFya2VyKGluZGV4LCAnb3V0Jyk7XG4gICAgfSk7XG5cbiAgICBsZXQgc2l6ZSA9IDA7XG4gICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGZ1bmN0aW9uIGFuaW1hdGUoKSB7XG4gICAgICBpZiAoc2l6ZSA+PSAyMCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIG1hcmtlci5zZXRJY29uKHsgLi4ubWFya2VyLmdldEljb24oKSwgc2NhbGU6IHNpemV9KTtcbiAgICAgIHNpemUgPSBzaXplICsgMjtcbiAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTtcbiAgICB9KTtcblxuICAgIGlmIChpbmRleCA9PT0gdGhpcy5hY3RpdmVNYXJrZXJJbmRleCkge1xuICAgICAgdGhpcy50b29sdGlwTm9kZS5hbmltYXRlKFtcbiAgICAgICAgeyBvcGFjaXR5OiAwLCB0cmFuc2Zvcm06ICd0cmFuc2xhdGVZKDBweCknIH0sXG4gICAgICAgIHsgb3BhY2l0eTogMSwgdHJhbnNmb3JtOiAndHJhbnNsYXRlWSgxMHB4KScgfVxuICAgICAgXSwgdGhpcy5jb25zdHJ1Y3Rvci5BTklNQVRJT05fT1BUSU9OUyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMudG9vbHRpcE5vZGUuYW5pbWF0ZShbXG4gICAgICAgIHsgb3BhY2l0eTogMCwgdHJhbnNmb3JtOiAndHJhbnNsYXRlWSgtMjBweCknIH0sXG4gICAgICAgIHsgb3BhY2l0eTogMSwgdHJhbnNmb3JtOiAndHJhbnNsYXRlWSgwKScgfVxuICAgICAgXSwgdGhpcy5jb25zdHJ1Y3Rvci5BTklNQVRJT05fT1BUSU9OUyk7XG4gICAgfVxuICB9XG5cbiAgc2V0QWN0aXZlKGluZGV4KSB7XG4gICAgaWYgKGluZGV4ID09PSB0aGlzLmFjdGl2ZU1hcmtlckluZGV4KSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgeyBhZGRyZXNzIH0gPSB0aGlzLmRhdGFbaW5kZXhdO1xuICAgIGNvbnN0ICRpdGVtID0gdGhpcy4kbWFya2VyTm9kZXNbaW5kZXhdO1xuXG4gICAgaWYgKGluZGV4ID09PSB0aGlzLmFjdGl2ZUluZGV4KSB7XG4gICAgICB0aGlzLnRvb2x0aXBOb2RlLnN0eWxlLnRvcCA9ICcxOHB4JztcbiAgICB9XG5cbiAgICBpZiAodGhpcy4kYWN0aXZlKSB7XG4gICAgICB0aGlzLmRlbE1vZCh0aGlzLiRhY3RpdmUsICdyZXN1bHQtaXRlbScsICdhY3RpdmUnKTtcbiAgICAgIHRoaXMubWFya2Vyc1t0aGlzLiRhY3RpdmUuZGF0YXNldC5pbmRleF0uc2V0SWNvbih0aGlzLmRlZmF1bHRNYXJrZXJJY29uKTtcbiAgICB9XG5cbiAgICB0aGlzLnNldE1vZCgkaXRlbSwgJ3Jlc3VsdC1pdGVtJywgJ2FjdGl2ZScpO1xuICAgIHRoaXMuJGFjdGl2ZSA9ICRpdGVtO1xuICAgIHRoaXMuYWN0aXZlTWFya2VySW5kZXggPSBOdW1iZXIoaW5kZXgpO1xuXG4gICAgdGhpcy5tYXJrZXJzWyRpdGVtLmRhdGFzZXQuaW5kZXhdLnNldEljb24odGhpcy5hY3RpdmVNYXJrZXJJY29uKTtcblxuICAgIHRoaXMuYWN0aXZlTWFya2VyLnNldFBvc2l0aW9uKHsgbGF0OiBhZGRyZXNzLmNvb3JkaW5hdGVzWzBdLCBsbmc6IGFkZHJlc3MuY29vcmRpbmF0ZXNbMV0gfSlcbiAgfVxuXG4gIGNyZWF0ZU1hcmtlcihbbGF0LCBsbmddKSB7XG4gICAgcmV0dXJuIG5ldyBnb29nbGUubWFwcy5NYXJrZXIoe1xuICAgICAgcG9zaXRpb246IHtsYXQsIGxuZ30sXG4gICAgICB6SW5kZXg6IC0xLFxuICAgICAgaWNvbjogdGhpcy5kZWZhdWx0TWFya2VySWNvbixcbiAgICAgIGRyYWdnYWJsZTogZmFsc2UsXG4gICAgICBtYXA6IHRoaXMubWFwXG4gICAgfSk7XG4gIH1cblxuICBnZXQgZGVmYXVsdE1hcmtlckljb24oKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHBhdGg6IGdvb2dsZS5tYXBzLlN5bWJvbFBhdGguQ0lSQ0xFLFxuICAgICAgc2NhbGU6IDQsXG4gICAgICBzdHJva2VDb2xvcjogJyM0ODgwZWQnLFxuICAgICAgZmlsbE9wYWNpdHk6IDEsXG4gICAgICBmaWxsQ29sb3I6ICcjNDg4MGVkJ1xuICAgIH07XG4gIH1cblxuICBnZXQgYWN0aXZlTWFya2VySWNvbigpIHtcbiAgICByZXR1cm4ge1xuICAgICAgcGF0aDogZ29vZ2xlLm1hcHMuU3ltYm9sUGF0aC5DSVJDTEUsXG4gICAgICBzY2FsZTogOCxcbiAgICAgIHN0cm9rZUNvbG9yOiAnIzQ4ODBlZCcsXG4gICAgICBmaWxsT3BhY2l0eTogMSxcbiAgICAgIGZpbGxDb2xvcjogJyNmZmZmZmYnLFxuICAgICAgc3Ryb2tlV2VpZ2h0OiA2XG4gICAgfTtcbiAgfVxuXG4gIGdldCB0b29sdGlwTm9kZSgpIHtcbiAgICByZXR1cm4gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmdtLXN0eWxlLWl3Jyk7XG4gIH1cblxuICBzdGF0aWMgQU5JTUFUSU9OX09QVElPTlMgPSB7XG4gICAgZHVyYXRpb246IDIwMCxcbiAgICBmaWxsOiAnZm9yd2FyZHMnLFxuICAgIGVhc2luZzogJ2Vhc2UtaW4tb3V0J1xuICB9XG59IiwiY29uc3Qgb2JqZWN0VG9RdWVyeSA9ICh0YXJnZXQpID0+IChcbiAgJz8nICsgT2JqZWN0LmtleXModGFyZ2V0KS5yZWR1Y2UoKGFyciwga2V5KSA9PiAoXG4gICAgYXJyLnB1c2goYCR7a2V5fT0ke3RhcmdldFtrZXldfWApICYmIGFyclxuICApLCBbXSkuam9pbignJicpXG4pO1xuXG5leHBvcnQgY29uc3QgbnVtYmVyRm9ybWF0dGluZyA9IG51bWJlciA9PiAoXG4gIG51bWJlci50b0ZpeGVkKDIpLnJlcGxhY2UoLyhcXGQpKD89KFxcZHszfSkrXFwuKS9nLCAnJDEgJykuc3BsaXQoJy4nKVswXVxuKTtcblxuZXhwb3J0IGNvbnN0IGZldGNoSlNPTiA9ICh1cmwsIG9wdGlvbnMgPSB7IG1ldGhvZDogJ0dFVCcgfSkgPT4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICBjb25zdCByZXF1ZXN0ID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG5cbiAgaWYgKG9wdGlvbnMuYm9keSAmJiBvcHRpb25zLm1ldGhvZCA9PT0gJ0dFVCcpIHtcbiAgICB1cmwgKz0gb2JqZWN0VG9RdWVyeShvcHRpb25zLmJvZHkpO1xuICB9XG5cbiAgcmVxdWVzdC5vbnJlYWR5c3RhdGVjaGFuZ2UgPSAoKSA9PiB7XG4gICAgaWYgKHJlcXVlc3QucmVhZHlTdGF0ZSAhPT0gNCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHJlc29sdmUoSlNPTi5wYXJzZShyZXF1ZXN0LnJlc3BvbnNlVGV4dCkpO1xuICB9O1xuXG4gIHJlcXVlc3Qub25lcnJvciA9IHJlamVjdDtcbiAgcmVxdWVzdC5vcGVuKG9wdGlvbnMubWV0aG9kIHx8ICdHRVQnLCB1cmwpO1xuICByZXF1ZXN0LnNlbmQob3B0aW9ucy5ib2R5ID8gSlNPTi5zdHJpbmdpZnkob3B0aW9ucy5ib2R5KSA6IG51bGwpO1xufSk7Il19
