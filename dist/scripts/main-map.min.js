(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var toArray = exports.toArray = function toArray(arrayLike) {
  if (Array.isArray(arrayLike)) {
    return arrayLike;
  }

  if (arrayLike instanceof Node) {
    return [arrayLike];
  }

  return Array.prototype.slice.call(arrayLike);
};

var $ = exports.$ = function $(selector) {
  var context = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : document;
  return toArray(context.querySelectorAll.call(context, selector));
};

var selector = exports.selector = function selector(block, elem, modName, modVal) {
  return block + '__' + elem + (modName ? modVal ? '_' + modName + '_' + modVal : '_' + modName : '');
};

var buildClass = exports.buildClass = function buildClass() {
  return '.' + selector.apply(undefined, arguments);
};

var getParents = exports.getParents = function getParents(target) {
  var parent = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : document;

  var parents = [];
  var p = target.parentNode;

  while (p !== parent) {
    var o = p;
    parents.push(o);
    p = o.parentNode;
  }
  parents.push(parent);

  return parents;
};

var BEM = exports.BEM = function (_ref) {
  _inherits(BEM, _ref);

  function BEM(name, node) {
    _classCallCheck(this, BEM);

    var _this = _possibleConstructorReturn(this, (BEM.__proto__ || Object.getPrototypeOf(BEM)).call(this));

    _this.node = node;
    _this.name = name;
    return _this;
  }

  _createClass(BEM, [{
    key: 'elem',
    value: function elem(name, modName, modVal) {
      return this.node.querySelector(buildClass(this.name, name, modName, modVal));
    }
  }, {
    key: 'elems',
    value: function elems(name, modName, modVal) {
      var _this2 = this;

      return $(buildClass(this.name, name, modName, modVal), this.node).filter(function (node) {
        var $parents = getParents(node, _this2.node);
        var $firstBlock = $parents.filter(function (parent) {
          return parent.classList.contains(_this2.name);
        })[0];

        return $firstBlock === _this2.node;
      });
    }
  }, {
    key: 'setMod',
    value: function setMod(elem, elemName, modName, modValue) {
      var _this3 = this;

      toArray(elem).forEach(function (node) {
        return node.classList.add(selector(_this3.name, elemName, modName, modValue));
      });

      return this;
    }
  }, {
    key: 'delMod',
    value: function delMod(elem, elemName, modName) {
      var _this4 = this;

      toArray(elem).forEach(function (node) {
        return node.classList.remove(selector(_this4.name, elemName, modName));
      });

      return this;
    }
  }]);

  return BEM;
}(null);

},{}],2:[function(require,module,exports){
'use strict';

var _dom = require('./dom');

var _utils = require('./utils');

var _search = require('./search');

var _search2 = _interopRequireDefault(_search);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

(0, _utils.fetchJSON)('data/search.json').then(function (data) {
  (0, _dom.$)('.search').forEach(function (node) {
    return new _search2.default(node, data);
  });
});

},{"./dom":1,"./search":3,"./utils":4}],3:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"]) _i["return"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError("Invalid attempt to destructure non-iterable instance"); } }; }();

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _dom = require('./dom');

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var HOVER_DEBOUNCE_TIMEOUT = 200;

var createItem = function createItem(data) {
  var node = document.createElement('li');

  node.classList.add((0, _dom.selector)('search', 'result-item'));
  node.innerHTML = '\n    <div class="search__result-item-title">\n        ' + data.name + '\n    </div>\n    ' + data.address.settlement + ' <br />\n    ' + data.address.street + ', ' + data.address.building + ' <br />\n    \u0422\u0435\u043B.: ' + data.phones[0].number + ' <br />\n    \u0413\u043E\u0434\u0438\u043D\u0438 \u0440\u043E\u0431\u043E\u0442\u0438: \u041F\u043D-\u041F\u0442, 9:00-19:00\n  ';

  return node;
};

var getTooltipContent = function getTooltipContent(data) {
  return '<div class="search__map-tooltip">\n    <b>' + data.name + '</b> <br />\n    ' + data.address.settlement + ' <br />\n    ' + data.address.street + ', ' + data.address.building + ' <br />\n    \u0422\u0435\u043B.: ' + data.phones[0].number + ' <br />\n    \n    <div class="search__map-tooltip-count">\n        ' + data.doctors + '\n        <small>\u043B\u0456\u043A\u0430\u0440\u0456\u0432</small>\n    </div>\n    <div class="search__map-tooltip-count">\n        ' + data.declarations + '\n        <small>\u0434\u0435\u043A\u043B\u0430\u0440\u0430\u0446\u0456\u0439 \u043F\u0456\u0434\u043F\u0438\u0441\u0430\u043D\u043E</small>\n    </div>\n  </div>';
};

var Search = function (_BEM) {
  _inherits(Search, _BEM);

  function Search(node, data) {
    _classCallCheck(this, Search);

    var _this = _possibleConstructorReturn(this, (Search.__proto__ || Object.getPrototypeOf(Search)).call(this, 'search', node));

    _this.markers = [];
    _this.$markerNodes = [];
    _this.timeout = null;


    _this.$result = _this.elem('result');

    _this.data = data;
    _this.map = new google.maps.Map(_this.elem('map'), {
      center: { lat: 50.4021368, lng: 30.4525107 },
      zoom: 11
    });

    _this.tooltip = new google.maps.InfoWindow({
      maxWidth: 250,
      pixelOffset: new google.maps.Size(136, 388),
      zIndex: -2
    });

    var fragment = document.createDocumentFragment();

    _this.data.forEach(function (item, index) {
      var node = createItem(item);

      node.dataset.index = index;
      fragment.appendChild(node);

      var marker = _this.createMarker(item.address.coordinates);
      _this.markers.push(marker);
      _this.$markerNodes.push(node);

      marker.addListener('click', function () {
        return _this.setActive(index);
      });
      marker.addListener('mouseover', function (_ref) {
        var ta = _ref.ta;

        _this.onHoverMarker(index, 'over', ta.target);
      });
      marker.addListener('mouseout', function () {
        return _this.onHoverMarker(index, 'out');
      });
    });

    _this.$result.appendChild(fragment);

    _this.$result.addEventListener('click', function (_ref2) {
      var target = _ref2.target;

      var $item = target.closest((0, _dom.buildClass)(_this.name, 'result-item'));

      if ($item === null) {
        return;
      }

      _this.map.setCenter({
        lat: _this.data[$item.dataset.index].address.coordinates[0],
        lng: _this.data[$item.dataset.index].address.coordinates[1]
      });

      _this.map.setZoom(11);

      _this.setActive($item.dataset.index);
    }, false);

    _this.activeMarker = new google.maps.Marker({
      map: _this.map,
      zIndex: 2,
      icon: {
        url: 'images/icons/marker.png',
        scaledSize: new google.maps.Size(33, 47),
        anchor: new google.maps.Point(17, 60)
      }
    });
    return _this;
  }

  _createClass(Search, [{
    key: 'onHoverMarker',
    value: function onHoverMarker(index, type) {
      var _this2 = this;

      clearTimeout(this.timeout);
      this.timeout = setTimeout(function () {
        switch (type) {
          case 'over':
            _this2.showTooltip(index);
            break;
          case 'out':
            _this2.hideTooltip();
            break;
        }
      }, HOVER_DEBOUNCE_TIMEOUT);
    }
  }, {
    key: 'hideTooltip',
    value: function hideTooltip() {
      var _this3 = this;

      var node = this.$tooltipNode;

      if (!node) {
        return;
      }

      var player = node.animate([{ opacity: 1, transform: 'translateY(0)' }, { opacity: 0, transform: 'translateY(-20px)' }], this.constructor.ANIMATION_OPTIONS);

      var marker = this.hoverMarker;
      var size = 20;
      requestAnimationFrame(function animate() {
        if (size <= 0) {
          marker.setMap(null);
          return;
        }

        marker.setIcon(_extends({}, marker.getIcon(), { scale: size }));
        size = size - 2;
        requestAnimationFrame(animate);
      });

      player.onfinish = function () {
        _this3.tooltip.close();
      };

      this.activeIndex = -1;
    }
  }, {
    key: 'showTooltip',
    value: function showTooltip(index) {
      var _this4 = this;

      if (index === this.activeIndex) {
        return;
      }

      this.tooltip.setContent(getTooltipContent(this.data[index]));
      this.tooltip.open(this.map, this.markers[index]);

      var node = this.$tooltipNode = this.tooltipNode.parentNode;
      node.removeChild(node.firstChild);
      node.removeChild(node.lastChild);

      node.addEventListener('mouseover', function () {
        clearTimeout(_this4.timeout);
      }, false);

      node.addEventListener('mouseout', function () {
        _this4.onHoverMarker(index, 'out');
      }, false);

      if (this.hoverMarker) {
        this.hoverMarker.setMap(null);
      }

      var marker = this.hoverMarker = new google.maps.Marker({
        position: {
          lat: this.data[index].address.coordinates[0],
          lng: this.data[index].address.coordinates[1]
        },
        zIndex: -2,
        icon: {
          path: google.maps.SymbolPath.CIRCLE,
          scale: 0,
          strokeColor: '#4880ed',
          fillOpacity: 1,
          fillColor: '#4880ed'
        },
        opacity: .1,
        draggable: true,
        map: this.map
      });

      this.activeIndex = index;

      marker.addListener('mouseover', function () {
        _this4.onHoverMarker(index, 'over');
      });

      marker.addListener('mouseout', function () {
        _this4.onHoverMarker(index, 'out');
      });

      var size = 0;
      requestAnimationFrame(function animate() {
        if (size >= 20) {
          return;
        }

        marker.setIcon(_extends({}, marker.getIcon(), { scale: size }));
        size = size + 2;
        requestAnimationFrame(animate);
      });

      if (index === this.activeMarkerIndex) {
        this.tooltipNode.animate([{ opacity: 0, transform: 'translateY(0px)' }, { opacity: 1, transform: 'translateY(10px)' }], this.constructor.ANIMATION_OPTIONS);
      } else {
        this.tooltipNode.animate([{ opacity: 0, transform: 'translateY(-20px)' }, { opacity: 1, transform: 'translateY(0)' }], this.constructor.ANIMATION_OPTIONS);
      }
    }
  }, {
    key: 'setActive',
    value: function setActive(index) {
      if (index === this.activeMarkerIndex) {
        return;
      }

      var address = this.data[index].address;

      var $item = this.$markerNodes[index];

      if (index === this.activeIndex) {
        this.tooltipNode.style.top = '18px';
      }

      if (this.$active) {
        this.delMod(this.$active, 'result-item', 'active');
        this.markers[this.$active.dataset.index].setIcon(this.defaultMarkerIcon);
      }

      this.setMod($item, 'result-item', 'active');
      this.$active = $item;
      this.activeMarkerIndex = Number(index);

      this.markers[$item.dataset.index].setIcon(this.activeMarkerIcon);

      this.activeMarker.setPosition({ lat: address.coordinates[0], lng: address.coordinates[1] });
    }
  }, {
    key: 'createMarker',
    value: function createMarker(_ref3) {
      var _ref4 = _slicedToArray(_ref3, 2),
          lat = _ref4[0],
          lng = _ref4[1];

      return new google.maps.Marker({
        position: { lat: lat, lng: lng },
        zIndex: -1,
        icon: this.defaultMarkerIcon,
        draggable: false,
        map: this.map
      });
    }
  }, {
    key: 'defaultMarkerIcon',
    get: function get() {
      return {
        path: google.maps.SymbolPath.CIRCLE,
        scale: 4,
        strokeColor: '#4880ed',
        fillOpacity: 1,
        fillColor: '#4880ed'
      };
    }
  }, {
    key: 'activeMarkerIcon',
    get: function get() {
      return {
        path: google.maps.SymbolPath.CIRCLE,
        scale: 8,
        strokeColor: '#4880ed',
        fillOpacity: 1,
        fillColor: '#ffffff',
        strokeWeight: 6
      };
    }
  }, {
    key: 'tooltipNode',
    get: function get() {
      return document.querySelector('.gm-style-iw');
    }
  }]);

  return Search;
}(_dom.BEM);

Search.ANIMATION_OPTIONS = {
  duration: 200,
  fill: 'forwards',
  easing: 'ease-in-out'
};
exports.default = Search;
module.exports = exports['default'];

},{"./dom":1}],4:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
var objectToQuery = function objectToQuery(target) {
  return '?' + Object.keys(target).reduce(function (arr, key) {
    return arr.push(key + '=' + target[key]) && arr;
  }, []).join('&');
};

var numberFormatting = exports.numberFormatting = function numberFormatting(number) {
  return number.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1 ').split('.')[0];
};

var fetchJSON = exports.fetchJSON = function fetchJSON(url) {
  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : { method: 'GET' };
  return new Promise(function (resolve, reject) {
    var request = new XMLHttpRequest();

    if (options.body && options.method === 'GET') {
      url += objectToQuery(options.body);
    }

    request.onreadystatechange = function () {
      if (request.readyState !== 4) {
        return;
      }

      resolve(JSON.parse(request.responseText));
    };

    request.onerror = reject;
    request.open(options.method || 'GET', url);
    request.send(options.body ? JSON.stringify(options.body) : null);
  });
};

},{}]},{},[2])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvc2NyaXB0cy9kb20uanMiLCJzcmMvc2NyaXB0cy9tYWluLW1hcC5qcyIsInNyYy9zY3JpcHRzL3NlYXJjaC5qcyIsInNyYy9zY3JpcHRzL3V0aWxzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7Ozs7Ozs7QUNBTyxJQUFNLDRCQUFVLFNBQVYsT0FBVSxZQUFhO0FBQ2xDLE1BQUksTUFBTSxPQUFOLENBQWMsU0FBZCxDQUFKLEVBQThCO0FBQzVCLFdBQU8sU0FBUDtBQUNEOztBQUVELE1BQUkscUJBQXFCLElBQXpCLEVBQStCO0FBQzdCLFdBQU8sQ0FBQyxTQUFELENBQVA7QUFDRDs7QUFFRCxTQUFPLE1BQU0sU0FBTixDQUFnQixLQUFoQixDQUFzQixJQUF0QixDQUEyQixTQUEzQixDQUFQO0FBQ0QsQ0FWTTs7QUFZQSxJQUFNLGdCQUFJLFNBQUosQ0FBSSxDQUFDLFFBQUQ7QUFBQSxNQUFXLE9BQVgsdUVBQXFCLFFBQXJCO0FBQUEsU0FDZixRQUFRLFFBQVEsZ0JBQVIsQ0FBeUIsSUFBekIsQ0FBOEIsT0FBOUIsRUFBdUMsUUFBdkMsQ0FBUixDQURlO0FBQUEsQ0FBVjs7QUFJQSxJQUFNLDhCQUFXLFNBQVgsUUFBVyxDQUFDLEtBQUQsRUFBUSxJQUFSLEVBQWMsT0FBZCxFQUF1QixNQUF2QjtBQUFBLFNBQ25CLEtBRG1CLFVBQ1QsSUFEUyxJQUNGLFVBQVcsZUFBYSxPQUFiLFNBQXdCLE1BQXhCLFNBQXVDLE9BQWxELEdBQStELEVBRDdEO0FBQUEsQ0FBakI7O0FBSUEsSUFBTSxrQ0FBYSxTQUFiLFVBQWE7QUFBQSxlQUFpQixvQ0FBakI7QUFBQSxDQUFuQjs7QUFFQSxJQUFNLGtDQUFhLFNBQWIsVUFBYSxDQUFDLE1BQUQsRUFBK0I7QUFBQSxNQUF0QixNQUFzQix1RUFBYixRQUFhOztBQUN2RCxNQUFNLFVBQVUsRUFBaEI7QUFDQSxNQUFJLElB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QUFxQyxHQUROO0FBQUEsR0FBM0IsRUFFSCxFQUZHLEVBRUMsSUFGRCxDQUVNLEdBRk4sQ0FEYztBQUFBLENBQXRCOztBQU1PLElBQU0sOENBQW1CLFNBQW5CLGdCQUFtQjtBQUFBLFNBQzlCLE9BQU8sT0FBUCxDQUFlLENBQWYsRUFBa0IsT0FBbEIsQ0FBMEIscUJBQTFCLEVBQWlELEtBQWpELEVBQXdELEtBQXhELENBQThELEdBQTlELEVBQW1FLENBQW5FLENBRDhCO0FBQUEsQ0FBekI7O0FBSUEsSUFBTSxnQ0FBWSxTQUFaLFNBQVksQ0FBQyxHQUFEO0FBQUEsTUFBTSxPQUFOLHVFQUFnQixFQUFFLFFBQVEsS0FBVixFQUFoQjtBQUFBLFNBQXNDLElBQUksT0FBSixDQUFZLFVBQUMsT0FBRCxFQUFVLE1BQVYsRUFBcUI7QUFDOUYsUUFBTSxVQUFVLElBQUksY0FBSixFQUFoQjs7QUFFQSxRQUFJLFFBQVEsSUFBUixJQUFnQixRQUFRLE1BQVIsS0FBbUIsS0FBdkMsRUFBOEM7QUFDNUMsYUFBTyxjQUFjLFFBQVEsSUFBdEIsQ0FBUDtBQUNEOztBQUVELFlBQVEsa0JBQVIsR0FBNkIsWUFBTTtBQUNqQyxVQUFJLFFBQVEsVUFBUixLQUF1QixDQUEzQixFQUE4QjtBQUM1QjtBQUNEOztBQUVELGNBQVEsS0FBSyxLQUFMLENBQVcsUUFBUSxZQUFuQixDQUFSO0FBQ0QsS0FORDs7QUFRQSxZQUFRLE9BQVIsR0FBa0IsTUFBbEI7QUFDQSxZQUFRLElBQVIsQ0FBYSxRQUFRLE1BQVIsSUFBa0IsS0FBL0IsRUFBc0MsR0FBdEM7QUFDQSxZQUFRLElBQVIsQ0FBYSxRQUFRLElBQVIsR0FBZSxLQUFLLFNBQUwsQ0FBZSxRQUFRLElBQXZCLENBQWYsR0FBOEMsSUFBM0Q7QUFDRCxHQWxCOEQsQ0FBdEM7QUFBQSxDQUFsQiIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCJleHBvcnQgY29uc3QgdG9BcnJheSA9IGFycmF5TGlrZSA9PiB7XG4gIGlmIChBcnJheS5pc0FycmF5KGFycmF5TGlrZSkpIHtcbiAgICByZXR1cm4gYXJyYXlMaWtlO1xuICB9XG5cbiAgaWYgKGFycmF5TGlrZSBpbnN0YW5jZW9mIE5vZGUpIHtcbiAgICByZXR1cm4gW2FycmF5TGlrZV07XG4gIH1cblxuICByZXR1cm4gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJyYXlMaWtlKTtcbn07XG5cbmV4cG9ydCBjb25zdCAkID0gKHNlbGVjdG9yLCBjb250ZXh0ID0gZG9jdW1lbnQpID0+IChcbiAgdG9BcnJheShjb250ZXh0LnF1ZXJ5U2VsZWN0b3JBbGwuY2FsbChjb250ZXh0LCBzZWxlY3RvcikpXG4pO1xuXG5leHBvcnQgY29uc3Qgc2VsZWN0b3IgPSAoYmxvY2ssIGVsZW0sIG1vZE5hbWUsIG1vZFZhbCkgPT4gKFxuICBgJHtibG9ja31fXyR7ZWxlbX0ke21vZE5hbWUgPyAobW9kVmFsID8gYF8ke21vZE5hbWV9XyR7bW9kVmFsfWAgOiBgXyR7bW9kTmFtZX1gKSA6ICcnfWBcbik7XG5cbmV4cG9ydCBjb25zdCBidWlsZENsYXNzID0gKC4uLmFyZ3MpID0+IGAuJHtzZWxlY3RvciguLi5hcmdzKX1gO1xuXG5leHBvcnQgY29uc3QgZ2V0UGFyZW50cyA9ICh0YXJnZXQsIHBhcmVudCA9IGRvY3VtZW50KSA9PiB7XG4gIGNvbnN0IHBhcmVudHMgPSBbXTtcbiAgbGV0IHAgPSB0YXJnZXQucGFyZW50Tm9kZTtcblxuICB3aGlsZSAocCAhPT0gcGFyZW50KSB7XG4gICAgbGV0IG8gPSBwO1xuICAgIHBhcmVudHMucHVzaChvKTtcbiAgICBwID0gby5wYXJlbnROb2RlO1xuICB9XG4gIHBhcmVudHMucHVzaChwYXJlbnQpO1xuXG4gIHJldHVybiBwYXJlbnRzO1xufTtcblxuZXhwb3J0IGNsYXNzIEJFTSBleHRlbmRzIG51bGwge1xuICBjb25zdHJ1Y3RvcihuYW1lLCBub2RlKSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLm5vZGUgPSBub2RlO1xuICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gIH1cblxuICBlbGVtKG5hbWUsIG1vZE5hbWUsIG1vZFZhbCkge1xuICAgIHJldHVybiB0aGlzLm5vZGUucXVlcnlTZWxlY3RvcihidWlsZENsYXNzKHRoaXMubmFtZSwgbmFtZSwgbW9kTmFtZSwgbW9kVmFsKSk7XG4gIH1cblxuICBlbGVtcyhuYW1lLCBtb2ROYW1lLCBtb2RWYWwpIHtcbiAgICByZXR1cm4gJChidWlsZENsYXNzKHRoaXMubmFtZSwgbmFtZSwgbW9kTmFtZSwgbW9kVmFsKSwgdGhpcy5ub2RlKS5maWx0ZXIobm9kZSA9PiB7XG4gICAgICBjb25zdCAkcGFyZW50cyA9IGdldFBhcmVudHMobm9kZSwgdGhpcy5ub2RlKTtcbiAgICAgIGNvbnN0ICRmaXJzdEJsb2NrID0gJHBhcmVudHMuZmlsdGVyKHBhcmVudCA9PiBwYXJlbnQuY2xhc3NMaXN0LmNvbnRhaW5zKHRoaXMubmFtZSkpWzBdO1xuXG4gICAgICByZXR1cm4gJGZpcnN0QmxvY2sgPT09IHRoaXMubm9kZTtcbiAgICB9KTtcbiAgfVxuXG4gIHNldE1vZChlbGVtLCBlbGVtTmFtZSwgbW9kTmFtZSwgbW9kVmFsdWUpIHtcbiAgICB0b0FycmF5KGVsZW0pLmZvckVhY2gobm9kZSA9PiAoXG4gICAgICBub2RlLmNsYXNzTGlzdC5hZGQoc2VsZWN0b3IodGhpcy5uYW1lLCBlbGVtTmFtZSwgbW9kTmFtZSwgbW9kVmFsdWUpKVxuICAgICkpO1xuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBkZWxNb2QoZWxlbSwgZWxlbU5hbWUsIG1vZE5hbWUpIHtcbiAgICB0b0FycmF5KGVsZW0pLmZvckVhY2gobm9kZSA9PiAoXG4gICAgICBub2RlLmNsYXNzTGlzdC5yZW1vdmUoc2VsZWN0b3IodGhpcy5uYW1lLCBlbGVtTmFtZSwgbW9kTmFtZSkpXG4gICAgKSk7XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfVxufSIsImltcG9ydCB7ICQgfSBmcm9tICcuL2RvbSc7XG5pbXBvcnQgeyBmZXRjaEpTT04gfSBmcm9tICcuL3V0aWxzJztcblxuaW1wb3J0IFNlYXJjaCBmcm9tICcuL3NlYXJjaCc7XG5cbmZldGNoSlNPTignZGF0YS9zZWFyY2guanNvbicpLnRoZW4oZGF0YSA9PiB7XG4gICQoJy5zZWFyY2gnKS5mb3JFYWNoKG5vZGUgPT4gbmV3IFNlYXJjaChub2RlLCBkYXRhKSk7XG59KTsiLCJpbXBvcnQgeyBCRU0sIHNlbGVjdG9yLCBidWlsZENsYXNzIH0gZnJvbSAnLi9kb20nO1xuXG5jb25zdCBIT1ZFUl9ERUJPVU5DRV9USU1FT1VUID0gMjAwO1xuXG5jb25zdCBjcmVhdGVJdGVtID0gKGRhdGEpID0+IHtcbiAgY29uc3Qgbm9kZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XG5cbiAgbm9kZS5jbGFzc0xpc3QuYWRkKHNlbGVjdG9yKCdzZWFyY2gnLCAncmVzdWx0LWl0ZW0nKSk7XG4gIG5vZGUuaW5uZXJIVE1MID0gYFxuICAgIDxkaXYgY2xhc3M9XCJzZWFyY2hfX3Jlc3VsdC1pdGVtLXRpdGxlXCI+XG4gICAgICAgICR7ZGF0YS5uYW1lfVxuICAgIDwvZGl2PlxuICAgICR7ZGF0YS5hZGRyZXNzLnNldHRsZW1lbnR9IDxiciAvPlxuICAgICR7ZGF0YS5hZGRyZXNzLnN0cmVldH0sICR7ZGF0YS5hZGRyZXNzLmJ1aWxkaW5nfSA8YnIgLz5cbiAgICDQotC10LsuOiAke2RhdGEucGhvbmVzWzBdLm51bWJlcn0gPGJyIC8+XG4gICAg0JPQvtC00LjQvdC4INGA0L7QsdC+0YLQuDog0J/QvS3Qn9GCLCA5OjAwLTE5OjAwXG4gIGA7XG5cbiAgcmV0dXJuIG5vZGU7XG59O1xuXG5jb25zdCBnZXRUb29sdGlwQ29udGVudCA9IGRhdGEgPT4gKFxuICBgPGRpdiBjbGFzcz1cInNlYXJjaF9fbWFwLXRvb2x0aXBcIj5cbiAgICA8Yj4ke2RhdGEubmFtZX08L2I+IDxiciAvPlxuICAgICR7ZGF0YS5hZGRyZXNzLnNldHRsZW1lbnR9IDxiciAvPlxuICAgICR7ZGF0YS5hZGRyZXNzLnN0cmVldH0sICR7ZGF0YS5hZGRyZXNzLmJ1aWxkaW5nfSA8YnIgLz5cbiAgICDQotC10LsuOiAke2RhdGEucGhvbmVzWzBdLm51bWJlcn0gPGJyIC8+XG4gICAgXG4gICAgPGRpdiBjbGFzcz1cInNlYXJjaF9fbWFwLXRvb2x0aXAtY291bnRcIj5cbiAgICAgICAgJHtkYXRhLmRvY3RvcnN9XG4gICAgICAgIDxzbWFsbD7Qu9GW0LrQsNGA0ZbQsjwvc21hbGw+XG4gICAgPC9kaXY+XG4gICAgPGRpdiBjbGFzcz1cInNlYXJjaF9fbWFwLXRvb2x0aXAtY291bnRcIj5cbiAgICAgICAgJHtkYXRhLmRlY2xhcmF0aW9uc31cbiAgICAgICAgPHNtYWxsPtC00LXQutC70LDRgNCw0YbRltC5INC/0ZbQtNC/0LjRgdCw0L3Qvjwvc21hbGw+XG4gICAgPC9kaXY+XG4gIDwvZGl2PmBcbik7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFNlYXJjaCBleHRlbmRzIEJFTSB7XG4gIG1hcmtlcnMgPSBbXTtcbiAgJG1hcmtlck5vZGVzID0gW107XG5cbiAgdGltZW91dCA9IG51bGw7XG5cbiAgY29uc3RydWN0b3Iobm9kZSwgZGF0YSkge1xuICAgIHN1cGVyKCdzZWFyY2gnLCBub2RlKTtcblxuICAgIHRoaXMuJHJlc3VsdCA9IHRoaXMuZWxlbSgncmVzdWx0Jyk7XG5cbiAgICB0aGlzLmRhdGEgPSBkYXRhO1xuICAgIHRoaXMubWFwID0gbmV3IGdvb2dsZS5tYXBzLk1hcCh0aGlzLmVsZW0oJ21hcCcpLCB7XG4gICAgICBjZW50ZXI6IHsgbGF0OiA1MC40MDIxMzY4LCBsbmc6IDMwLjQ1MjUxMDcgfSxcbiAgICAgIHpvb206IDExXG4gICAgfSk7XG5cbiAgICB0aGlzLnRvb2x0aXAgPSBuZXcgZ29vZ2xlLm1hcHMuSW5mb1dpbmRvdyh7XG4gICAgICBtYXhXaWR0aDogMjUwLFxuICAgICAgcGl4ZWxPZmZzZXQ6IG5ldyBnb29nbGUubWFwcy5TaXplKDEzNiwzODgpLFxuICAgICAgekluZGV4OiAtMlxuICAgIH0pO1xuXG4gICAgY29uc3QgZnJhZ21lbnQgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7XG5cbiAgICB0aGlzLmRhdGEuZm9yRWFjaCgoaXRlbSwgaW5kZXgpID0+IHtcbiAgICAgIGNvbnN0IG5vZGUgPSBjcmVhdGVJdGVtKGl0ZW0pO1xuXG4gICAgICBub2RlLmRhdGFzZXQuaW5kZXggPSBpbmRleDtcbiAgICAgIGZyYWdtZW50LmFwcGVuZENoaWxkKG5vZGUpO1xuXG4gICAgICBjb25zdCBtYXJrZXIgPSB0aGlzLmNyZWF0ZU1hcmtlcihpdGVtLmFkZHJlc3MuY29vcmRpbmF0ZXMpO1xuICAgICAgdGhpcy5tYXJrZXJzLnB1c2gobWFya2VyKTtcbiAgICAgIHRoaXMuJG1hcmtlck5vZGVzLnB1c2gobm9kZSk7XG5cbiAgICAgIG1hcmtlci5hZGRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB0aGlzLnNldEFjdGl2ZShpbmRleCkpO1xuICAgICAgbWFya2VyLmFkZExpc3RlbmVyKCdtb3VzZW92ZXInLCAoeyB0YSB9KSA9PiB7XG4gICAgICAgIHRoaXMub25Ib3Zlck1hcmtlcihpbmRleCwgJ292ZXInLCB0YS50YXJnZXQpO1xuICAgICAgfSk7XG4gICAgICBtYXJrZXIuYWRkTGlzdGVuZXIoJ21vdXNlb3V0JywgKCkgPT4gdGhpcy5vbkhvdmVyTWFya2VyKGluZGV4LCAnb3V0JykpO1xuICAgIH0pO1xuXG4gICAgdGhpcy4kcmVzdWx0LmFwcGVuZENoaWxkKGZyYWdtZW50KTtcblxuICAgIHRoaXMuJHJlc3VsdC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICh7IHRhcmdldCB9KSA9PiB7XG4gICAgICBjb25zdCAkaXRlbSA9IHRhcmdldC5jbG9zZXN0KGJ1aWxkQ2xhc3ModGhpcy5uYW1lLCAncmVzdWx0LWl0ZW0nKSk7XG5cbiAgICAgIGlmICgkaXRlbSA9PT0gbnVsbCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHRoaXMubWFwLnNldENlbnRlcih7XG4gICAgICAgIGxhdDogdGhpcy5kYXRhWyRpdGVtLmRhdGFzZXQuaW5kZXhdLmFkZHJlc3MuY29vcmRpbmF0ZXNbMF0sXG4gICAgICAgIGxuZzogdGhpcy5kYXRhWyRpdGVtLmRhdGFzZXQuaW5kZXhdLmFkZHJlc3MuY29vcmRpbmF0ZXNbMV1cbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLm1hcC5zZXRab29tKDExKTtcblxuICAgICAgdGhpcy5zZXRBY3RpdmUoJGl0ZW0uZGF0YXNldC5pbmRleCk7XG4gICAgfSwgZmFsc2UpO1xuXG4gICAgdGhpcy5hY3RpdmVNYXJrZXIgPSBuZXcgZ29vZ2xlLm1hcHMuTWFya2VyKHtcbiAgICAgIG1hcDogdGhpcy5tYXAsXG4gICAgICB6SW5kZXg6IDIsXG4gICAgICBpY29uOiB7XG4gICAgICAgIHVybDogJ2ltYWdlcy9pY29ucy9tYXJrZXIucG5nJyxcbiAgICAgICAgc2NhbGVkU2l6ZTogbmV3IGdvb2dsZS5tYXBzLlNpemUoMzMsIDQ3KSxcbiAgICAgICAgYW5jaG9yOiBuZXcgZ29vZ2xlLm1hcHMuUG9pbnQoMTcsIDYwKSxcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIG9uSG92ZXJNYXJrZXIoaW5kZXgsIHR5cGUpIHtcbiAgICBjbGVhclRpbWVvdXQodGhpcy50aW1lb3V0KTtcbiAgICB0aGlzLnRpbWVvdXQgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIHN3aXRjaCAodHlwZSkge1xuICAgICAgICBjYXNlICdvdmVyJzpcbiAgICAgICAgICB0aGlzLnNob3dUb29sdGlwKGluZGV4KTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnb3V0JzpcbiAgICAgICAgICB0aGlzLmhpZGVUb29sdGlwKCk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfSwgSE9WRVJfREVCT1VOQ0VfVElNRU9VVCk7XG4gIH1cblxuICBoaWRlVG9vbHRpcCgpIHtcbiAgICBjb25zdCBub2RlID0gdGhpcy4kdG9vbHRpcE5vZGU7XG5cbiAgICBpZiAoIW5vZGUpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBwbGF5ZXIgPSBub2RlLmFuaW1hdGUoW1xuICAgICAgeyBvcGFjaXR5OiAxLCB0cmFuc2Zvcm06ICd0cmFuc2xhdGVZKDApJyB9LFxuICAgICAgeyBvcGFjaXR5OiAwLCB0cmFuc2Zvcm06ICd0cmFuc2xhdGVZKC0yMHB4KScgfVxuICAgIF0sIHRoaXMuY29uc3RydWN0b3IuQU5JTUFUSU9OX09QVElPTlMpO1xuXG4gICAgY29uc3QgbWFya2VyID0gdGhpcy5ob3Zlck1hcmtlcjtcbiAgICBsZXQgc2l6ZSA9IDIwO1xuICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShmdW5jdGlvbiBhbmltYXRlKCkge1xuICAgICAgaWYgKHNpemUgPD0gMCkge1xuICAgICAgICBtYXJrZXIuc2V0TWFwKG51bGwpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIG1hcmtlci5zZXRJY29uKHsgLi4ubWFya2VyLmdldEljb24oKSwgc2NhbGU6IHNpemV9KTtcbiAgICAgIHNpemUgPSBzaXplIC0gMjtcbiAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTtcbiAgICB9KTtcblxuICAgIHBsYXllci5vbmZpbmlzaCA9ICgpID0+IHtcbiAgICAgIHRoaXMudG9vbHRpcC5jbG9zZSgpO1xuICAgIH07XG5cbiAgICB0aGlzLmFjdGl2ZUluZGV4ID0gLTE7XG4gIH1cblxuICBzaG93VG9vbHRpcChpbmRleCkge1xuICAgIGlmIChpbmRleCA9PT0gdGhpcy5hY3RpdmVJbmRleCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMudG9vbHRpcC5zZXRDb250ZW50KGdldFRvb2x0aXBDb250ZW50KHRoaXMuZGF0YVtpbmRleF0pKTtcbiAgICB0aGlzLnRvb2x0aXAub3Blbih0aGlzLm1hcCwgdGhpcy5tYXJrZXJzW2luZGV4XSk7XG5cbiAgICBjb25zdCBub2RlID0gdGhpcy4kdG9vbHRpcE5vZGUgPSB0aGlzLnRvb2x0aXBOb2RlLnBhcmVudE5vZGU7XG4gICAgbm9kZS5yZW1vdmVDaGlsZChub2RlLmZpcnN0Q2hpbGQpO1xuICAgIG5vZGUucmVtb3ZlQ2hpbGQobm9kZS5sYXN0Q2hpbGQpO1xuXG4gICAgbm9kZS5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW92ZXInLCAoKSA9PiB7XG4gICAgICBjbGVhclRpbWVvdXQodGhpcy50aW1lb3V0KTtcbiAgICB9LCBmYWxzZSk7XG5cbiAgICBub2RlLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlb3V0JywgKCkgPT4ge1xuICAgICAgdGhpcy5vbkhvdmVyTWFya2VyKGluZGV4LCAnb3V0Jyk7XG4gICAgfSwgZmFsc2UpO1xuXG4gICAgaWYgKHRoaXMuaG92ZXJNYXJrZXIpIHtcbiAgICAgIHRoaXMuaG92ZXJNYXJrZXIuc2V0TWFwKG51bGwpO1xuICAgIH1cblxuICAgIGNvbnN0IG1hcmtlciA9IHRoaXMuaG92ZXJNYXJrZXIgPSBuZXcgZ29vZ2xlLm1hcHMuTWFya2VyKHtcbiAgICAgIHBvc2l0aW9uOiB7XG4gICAgICAgIGxhdDogdGhpcy5kYXRhW2luZGV4XS5hZGRyZXNzLmNvb3JkaW5hdGVzWzBdLFxuICAgICAgICBsbmc6IHRoaXMuZGF0YVtpbmRleF0uYWRkcmVzcy5jb29yZGluYXRlc1sxXVxuICAgICAgfSxcbiAgICAgIHpJbmRleDogLTIsXG4gICAgICBpY29uOiB7XG4gICAgICAgIHBhdGg6IGdvb2dsZS5tYXBzLlN5bWJvbFBhdGguQ0lSQ0xFLFxuICAgICAgICBzY2FsZTogMCxcbiAgICAgICAgc3Ryb2tlQ29sb3I6ICcjNDg4MGVkJyxcbiAgICAgICAgZmlsbE9wYWNpdHk6IDEsXG4gICAgICAgIGZpbGxDb2xvcjogJyM0ODgwZWQnXG4gICAgICB9LFxuICAgICAgb3BhY2l0eTogLjEsXG4gICAgICBkcmFnZ2FibGU6IHRydWUsXG4gICAgICBtYXA6IHRoaXMubWFwXG4gICAgfSk7XG5cbiAgICB0aGlzLmFjdGl2ZUluZGV4ID0gaW5kZXg7XG5cbiAgICBtYXJrZXIuYWRkTGlzdGVuZXIoJ21vdXNlb3ZlcicsICgpID0+IHtcbiAgICAgIHRoaXMub25Ib3Zlck1hcmtlcihpbmRleCwgJ292ZXInKTtcbiAgICB9KTtcblxuICAgIG1hcmtlci5hZGRMaXN0ZW5lcignbW91c2VvdXQnLCAoKSA9PiB7XG4gICAgICB0aGlzLm9uSG92ZXJNYXJrZXIoaW5kZXgsICdvdXQnKTtcbiAgICB9KTtcblxuICAgIGxldCBzaXplID0gMDtcbiAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoZnVuY3Rpb24gYW5pbWF0ZSgpIHtcbiAgICAgIGlmIChzaXplID49IDIwKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgbWFya2VyLnNldEljb24oeyAuLi5tYXJrZXIuZ2V0SWNvbigpLCBzY2FsZTogc2l6ZX0pO1xuICAgICAgc2l6ZSA9IHNpemUgKyAyO1xuICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGUpO1xuICAgIH0pO1xuXG4gICAgaWYgKGluZGV4ID09PSB0aGlzLmFjdGl2ZU1hcmtlckluZGV4KSB7XG4gICAgICB0aGlzLnRvb2x0aXBOb2RlLmFuaW1hdGUoW1xuICAgICAgICB7IG9wYWNpdHk6IDAsIHRyYW5zZm9ybTogJ3RyYW5zbGF0ZVkoMHB4KScgfSxcbiAgICAgICAgeyBvcGFjaXR5OiAxLCB0cmFuc2Zvcm06ICd0cmFuc2xhdGVZKDEwcHgpJyB9XG4gICAgICBdLCB0aGlzLmNvbnN0cnVjdG9yLkFOSU1BVElPTl9PUFRJT05TKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy50b29sdGlwTm9kZS5hbmltYXRlKFtcbiAgICAgICAgeyBvcGFjaXR5OiAwLCB0cmFuc2Zvcm06ICd0cmFuc2xhdGVZKC0yMHB4KScgfSxcbiAgICAgICAgeyBvcGFjaXR5OiAxLCB0cmFuc2Zvcm06ICd0cmFuc2xhdGVZKDApJyB9XG4gICAgICBdLCB0aGlzLmNvbnN0cnVjdG9yLkFOSU1BVElPTl9PUFRJT05TKTtcbiAgICB9XG4gIH1cblxuICBzZXRBY3RpdmUoaW5kZXgpIHtcbiAgICBpZiAoaW5kZXggPT09IHRoaXMuYWN0aXZlTWFya2VySW5kZXgpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCB7IGFkZHJlc3MgfSA9IHRoaXMuZGF0YVtpbmRleF07XG4gICAgY29uc3QgJGl0ZW0gPSB0aGlzLiRtYXJrZXJOb2Rlc1tpbmRleF07XG5cbiAgICBpZiAoaW5kZXggPT09IHRoaXMuYWN0aXZlSW5kZXgpIHtcbiAgICAgIHRoaXMudG9vbHRpcE5vZGUuc3R5bGUudG9wID0gJzE4cHgnO1xuICAgIH1cblxuICAgIGlmICh0aGlzLiRhY3RpdmUpIHtcbiAgICAgIHRoaXMuZGVsTW9kKHRoaXMuJGFjdGl2ZSwgJ3Jlc3VsdC1pdGVtJywgJ2FjdGl2ZScpO1xuICAgICAgdGhpcy5tYXJrZXJzW3RoaXMuJGFjdGl2ZS5kYXRhc2V0LmluZGV4XS5zZXRJY29uKHRoaXMuZGVmYXVsdE1hcmtlckljb24pO1xuICAgIH1cblxuICAgIHRoaXMuc2V0TW9kKCRpdGVtLCAncmVzdWx0LWl0ZW0nLCAnYWN0aXZlJyk7XG4gICAgdGhpcy4kYWN0aXZlID0gJGl0ZW07XG4gICAgdGhpcy5hY3RpdmVNYXJrZXJJbmRleCA9IE51bWJlcihpbmRleCk7XG5cbiAgICB0aGlzLm1hcmtlcnNbJGl0ZW0uZGF0YXNldC5pbmRleF0uc2V0SWNvbih0aGlzLmFjdGl2ZU1hcmtlckljb24pO1xuXG4gICAgdGhpcy5hY3RpdmVNYXJrZXIuc2V0UG9zaXRpb24oeyBsYXQ6IGFkZHJlc3MuY29vcmRpbmF0ZXNbMF0sIGxuZzogYWRkcmVzcy5jb29yZGluYXRlc1sxXSB9KVxuICB9XG5cbiAgY3JlYXRlTWFya2VyKFtsYXQsIGxuZ10pIHtcbiAgICByZXR1cm4gbmV3IGdvb2dsZS5tYXBzLk1hcmtlcih7XG4gICAgICBwb3NpdGlvbjoge2xhdCwgbG5nfSxcbiAgICAgIHpJbmRleDogLTEsXG4gICAgICBpY29uOiB0aGlzLmRlZmF1bHRNYXJrZXJJY29uLFxuICAgICAgZHJhZ2dhYmxlOiBmYWxzZSxcbiAgICAgIG1hcDogdGhpcy5tYXBcbiAgICB9KTtcbiAgfVxuXG4gIGdldCBkZWZhdWx0TWFya2VySWNvbigpIHtcbiAgICByZXR1cm4ge1xuICAgICAgcGF0aDogZ29vZ2xlLm1hcHMuU3ltYm9sUGF0aC5DSVJDTEUsXG4gICAgICBzY2FsZTogNCxcbiAgICAgIHN0cm9rZUNvbG9yOiAnIzQ4ODBlZCcsXG4gICAgICBmaWxsT3BhY2l0eTogMSxcbiAgICAgIGZpbGxDb2xvcjogJyM0ODgwZWQnXG4gICAgfTtcbiAgfVxuXG4gIGdldCBhY3RpdmVNYXJrZXJJY29uKCkge1xuICAgIHJldHVybiB7XG4gICAgICBwYXRoOiBnb29nbGUubWFwcy5TeW1ib2xQYXRoLkNJUkNMRSxcbiAgICAgIHNjYWxlOiA4LFxuICAgICAgc3Ryb2tlQ29sb3I6ICcjNDg4MGVkJyxcbiAgICAgIGZpbGxPcGFjaXR5OiAxLFxuICAgICAgZmlsbENvbG9yOiAnI2ZmZmZmZicsXG4gICAgICBzdHJva2VXZWlnaHQ6IDZcbiAgICB9O1xuICB9XG5cbiAgZ2V0IHRvb2x0aXBOb2RlKCkge1xuICAgIHJldHVybiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZ20tc3R5bGUtaXcnKTtcbiAgfVxuXG4gIHN0YXRpYyBBTklNQVRJT05fT1BUSU9OUyA9IHtcbiAgICBkdXJhdGlvbjogMjAwLFxuICAgIGZpbGw6ICdmb3J3YXJkcycsXG4gICAgZWFzaW5nOiAnZWFzZS1pbi1vdXQnXG4gIH1cbn0iLCJjb25zdCBvYmplY3RUb1F1ZXJ5ID0gKHRhcmdldCkgPT4gKFxuICAnPycgKyBPYmplY3Qua2V5cyh0YXJnZXQpLnJlZHVjZSgoYXJyLCBrZXkpID0+IChcbiAgICBhcnIucHVzaChgJHtrZXl9PSR7dGFyZ2V0W2tleV19YCkgJiYgYXJyXG4gICksIFtdKS5qb2luKCcmJylcbik7XG5cbmV4cG9ydCBjb25zdCBudW1iZXJGb3JtYXR0aW5nID0gbnVtYmVyID0+IChcbiAgbnVtYmVyLnRvRml4ZWQoMikucmVwbGFjZSgvKFxcZCkoPz0oXFxkezN9KStcXC4pL2csICckMSAnKS5zcGxpdCgnLicpWzBdXG4pO1xuXG5leHBvcnQgY29uc3QgZmV0Y2hKU09OID0gKHVybCwgb3B0aW9ucyA9IHsgbWV0aG9kOiAnR0VUJyB9KSA9PiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gIGNvbnN0IHJlcXVlc3QgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcblxuICBpZiAob3B0aW9ucy5ib2R5ICYmIG9wdGlvbnMubWV0aG9kID09PSAnR0VUJykge1xuICAgIHVybCArPSBvYmplY3RUb1F1ZXJ5KG9wdGlvbnMuYm9keSk7XG4gIH1cblxuICByZXF1ZXN0Lm9ucmVhZHlzdGF0ZWNoYW5nZSA9ICgpID0+IHtcbiAgICBpZiAocmVxdWVzdC5yZWFkeVN0YXRlICE9PSA0KSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgcmVzb2x2ZShKU09OLnBhcnNlKHJlcXVlc3QucmVzcG9uc2VUZXh0KSk7XG4gIH07XG5cbiAgcmVxdWVzdC5vbmVycm9yID0gcmVqZWN0O1xuICByZXF1ZXN0Lm9wZW4ob3B0aW9ucy5tZXRob2QgfHwgJ0dFVCcsIHVybCk7XG4gIHJlcXVlc3Quc2VuZChvcHRpb25zLmJvZHkgPyBKU09OLnN0cmluZ2lmeShvcHRpb25zLmJvZHkpIDogbnVsbCk7XG59KTsiXX0=
