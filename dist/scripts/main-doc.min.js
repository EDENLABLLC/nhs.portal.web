(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var toArray = exports.toArray = function toArray(arrayLike) {
  if (Array.isArray(arrayLike)) {
    return arrayLike;
  }

  if (arrayLike instanceof Node) {
    return [arrayLike];
  }

  return Array.prototype.slice.call(arrayLike);
};

var $ = exports.$ = function $(selector) {
  var context = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : document;
  return toArray(context.querySelectorAll.call(context, selector));
};

var selector = exports.selector = function selector(block, elem, modName, modVal) {
  return block + '__' + elem + (modName ? modVal ? '_' + modName + '_' + modVal : '_' + modName : '');
};

var buildClass = exports.buildClass = function buildClass() {
  return '.' + selector.apply(undefined, arguments);
};

var getParents = exports.getParents = function getParents(target) {
  var parent = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : document;

  var parents = [];
  var p = target.parentNode;

  while (p !== parent) {
    var o = p;
    parents.push(o);
    p = o.parentNode;
  }
  parents.push(parent);

  return parents;
};

var BEM = exports.BEM = function (_ref) {
  _inherits(BEM, _ref);

  function BEM(name, node) {
    _classCallCheck(this, BEM);

    var _this = _possibleConstructorReturn(this, (BEM.__proto__ || Object.getPrototypeOf(BEM)).call(this));

    _this.node = node;
    _this.name = name;
    return _this;
  }

  _createClass(BEM, [{
    key: 'elem',
    value: function elem(name, modName, modVal) {
      return this.node.querySelector(buildClass(this.name, name, modName, modVal));
    }
  }, {
    key: 'elems',
    value: function elems(name, modName, modVal) {
      var _this2 = this;

      return $(buildClass(this.name, name, modName, modVal), this.node).filter(function (node) {
        var $parents = getParents(node, _this2.node);
        var $firstBlock = $parents.filter(function (parent) {
          return parent.classList.contains(_this2.name);
        })[0];

        return $firstBlock === _this2.node;
      });
    }
  }, {
    key: 'setMod',
    value: function setMod(elem, elemName, modName, modValue) {
      var _this3 = this;

      toArray(elem).forEach(function (node) {
        return node.classList.add(selector(_this3.name, elemName, modName, modValue));
      });

      return this;
    }
  }, {
    key: 'delMod',
    value: function delMod(elem, elemName, modName) {
      var _this4 = this;

      toArray(elem).forEach(function (node) {
        return node.classList.remove(selector(_this4.name, elemName, modName));
      });

      return this;
    }
  }]);

  return BEM;
}(null);

},{}],2:[function(require,module,exports){
'use strict';

var _dom = require('./dom');

var _tabs = require('./tabs');

var _tabs2 = _interopRequireDefault(_tabs);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

(0, _dom.$)('.tabs').forEach(function (node) {
  return new _tabs2.default(node, { autoHeight: true });
});

},{"./dom":1,"./tabs":3}],3:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _dom = require('./dom');

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var PANEL_ANIMATION_OPTIONS = {
  duration: 300,
  fill: 'forwards',
  easing: 'ease-in-out'
};

var Tabs = function (_BEM) {
  _inherits(Tabs, _BEM);

  function Tabs(node) {
    var _ref = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},
        _ref$autoHeight = _ref.autoHeight,
        autoHeight = _ref$autoHeight === undefined ? false : _ref$autoHeight;

    _classCallCheck(this, Tabs);

    var _this = _possibleConstructorReturn(this, (Tabs.__proto__ || Object.getPrototypeOf(Tabs)).call(this, 'tabs', node));

    _this.$controls = _this.elems('nav-item');
    _this.$slides = _this.elems('slide');

    _this.$marker = document.createElement('div');
    _this.$marker.classList.add((0, _dom.selector)(_this.name, 'marker'));

    _this.elem('header').appendChild(_this.$marker);

    if (autoHeight) {
      var maxHeight = _this.$slides.reduce(function (target, item) {
        if (item.clientHeight > target) {
          target = item.clientHeight;
        }

        return target;
      }, 0);

      _this.elem('main').style.height = maxHeight + 'px';
    }

    _this.currentIndex = _this.getIndexByElem(_this.elem('nav-item', 'active'));

    _this.elem('nav').addEventListener('click', function (e) {
      var $elem = e.target.closest((0, _dom.buildClass)(_this.name, 'nav-item'));

      if (!$elem) {
        return;
      }

      var toIndex = _this.getIndexByElem($elem);

      if (toIndex === _this.currentIndex) {
        return;
      }

      _this.delMod(_this.elem('nav-item', 'active'), 'nav-item', 'active');
      _this.setMod($elem, 'nav-item', 'active');

      _this.animatePanels(toIndex);
      _this.animateMarker(toIndex);

      _this.currentIndex = toIndex;
    }, false);

    _this.setMod(_this.elem('nav-item', 'active'), 'nav-item', 'marker');
    return _this;
  }

  _createClass(Tabs, [{
    key: 'animatePanels',
    value: function animatePanels(index) {
      var current = this.currentIndex;
      var isNext = current < index;

      current !== undefined && this.$slides[current].animate([{ transform: 'translateX(0)', opacity: 1 }, { transform: 'translateX(' + (isNext ? '-' : '') + '100%)', opacity: 0 }], PANEL_ANIMATION_OPTIONS);

      this.$slides[index].animate([{ transform: 'translateX(' + (isNext ? '' : '-') + '100%)', opacity: 0 }, { transform: 'translateX(0)', opacity: 1 }], PANEL_ANIMATION_OPTIONS);
    }
  }, {
    key: 'animateMarker',
    value: function animateMarker(index) {
      var _this2 = this;

      var current = {
        left: this.$controls[this.currentIndex].offsetLeft,
        width: this.$controls[this.currentIndex].clientWidth
      };

      var left = this.$controls[index].offsetLeft;
      var width = this.$controls[index].clientWidth;

      var player = this.$marker.animate([{
        transform: 'translateX(' + current.left + 'px)',
        width: current.width + 'px'
      }, {
        transform: 'translateX(' + left + 'px)',
        width: width + 'px'
      }], _extends({}, PANEL_ANIMATION_OPTIONS));

      player.onfinish = function () {
        _this2.setMod(_this2.$controls[index], 'nav-item', 'marker');
        requestAnimationFrame(function () {
          return player.cancel();
        });
      };

      this.delMod(this.$controls[this.currentIndex], 'nav-item', 'marker');
    }
  }, {
    key: 'getIndexByElem',
    value: function getIndexByElem(elem) {
      var index = -1;

      this.$controls.some(function (node, i) {
        if (node === elem) {
          index = i;
          return true;
        }
      });

      return index;
    }
  }]);

  return Tabs;
}(_dom.BEM);

exports.default = Tabs;
module.exports = exports['default'];

},{"./dom":1}]},{},[2])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvc2NyaXB0cy9kb20uanMiLCJzcmMvc2NyaXB0cy9tYWluLWRvYy5qcyIsInNyYy9zY3JpcHRzL3RhYnMuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7Ozs7Ozs7OztBQ0FPLElBQU0sNEJBQVUsU0FBVixPQUFVLFlBQWE7QUFDbEMsTUFBSSxNQUFNLE9BQU4sQ0FBYyxTQUFkLENBQUosRUFBOEI7QUFDNUIsV0FBTyxTQUFQO0FBQ0Q7O0FBRUQsTUFBSSxxQkFBcUIsSUFBekIsRUFBK0I7QUFDN0IsV0FBTyxDQUFDLFNBQUQsQ0FBUDtBQUNEOztBQUVELFNBQU8sTUFBTSxTQUFOLENBQWdCLEtBQWhCLENBQXNCLElBQXRCLENBQTJCLFNBQTNCLENBQVA7QUFDRCxDQVZNOztBQVlBLElBQU0sZ0JBQUksU0FBSixDQUFJLENBQUMsUUFBRDtBQUFBLE1BQVcsT0FBWCx1RUFBcUIsUUFBckI7QUFBQSxTQUNmLFFBQVEsUUFBUSxnQkFBUixDQUF5QixJQUF6QixDQUE4QixPQUE5QixFQUF1QyxRQUF2QyxDQUFSLENBRGU7QUFBQSxDQUFWOztBQUlBLElBQU0sOEJBQVcsU0FBWCxRQUFXLENBQUMsS0FBRCxFQUFRLElBQVIsRUFBYyxPQUFkLEVBQXVCLE1BQXZCO0FBQUEsU0FDbkIsS0FEbUIsVUFDVCxJQURTLElBQ0YsVUFBVyxlQUFhLE9BQWIsU0FBd0IsTUFBeEIsU0FBdUMsT0FBbEQsR0FBK0QsRUFEN0Q7QUFBQSxDQUFqQjs7QUFJQSxJQUFNLGtDQUFhLFNBQWIsVUFBYTtBQUFBLGVBQWlCLG9DQUFqQjtBQUFBLENBQW5COztBQUVBLElBQU0sa0NBQWEsU0FBYixVQUFhLENBQUMsTUFBRCxFQUErQjtBQUFBLE1BQXRCLE1BQXNCLHVFQUFiLFFBQWE7O0FBQ3ZELE1BQU0sVUFBVSxFQUFoQjtBQUNBLE1BQUksSUFBSSxPQUFPLFVBQWY7O0FBRUEsU0FBTyxN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RUFBZjs7QUFVQSxhQUFPLFFBQVAsR0FBa0IsWUFBTTtBQUN0QixlQUFLLE1BQUwsQ0FBWSxPQUFLLFNBQUwsQ0FBZSxLQUFmLENBQVosRUFBbUMsVUFBbkMsRUFBK0MsUUFBL0M7QUFDQSw4QkFBc0I7QUFBQSxpQkFBTSxPQUFPLE1BQVAsRUFBTjtBQUFBLFNBQXRCO0FBQ0QsT0FIRDs7QUFLQSxXQUFLLE1BQUwsQ0FBWSxLQUFLLFNBQUwsQ0FBZSxLQUFLLFlBQXBCLENBQVosRUFBK0MsVUFBL0MsRUFBMkQsUUFBM0Q7QUFDRDs7O21DQUVjLEksRUFBTTtBQUNuQixVQUFJLFFBQVEsQ0FBQyxDQUFiOztBQUVBLFdBQUssU0FBTCxDQUFlLElBQWYsQ0FBb0IsVUFBQyxJQUFELEVBQU8sQ0FBUCxFQUFhO0FBQy9CLFlBQUksU0FBUyxJQUFiLEVBQW1CO0FBQ2pCLGtCQUFRLENBQVI7QUFDQSxpQkFBTyxJQUFQO0FBQ0Q7QUFDRixPQUxEOztBQU9BLGFBQU8sS0FBUDtBQUNEOzs7Ozs7a0JBeEdrQixJIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsImV4cG9ydCBjb25zdCB0b0FycmF5ID0gYXJyYXlMaWtlID0+IHtcbiAgaWYgKEFycmF5LmlzQXJyYXkoYXJyYXlMaWtlKSkge1xuICAgIHJldHVybiBhcnJheUxpa2U7XG4gIH1cblxuICBpZiAoYXJyYXlMaWtlIGluc3RhbmNlb2YgTm9kZSkge1xuICAgIHJldHVybiBbYXJyYXlMaWtlXTtcbiAgfVxuXG4gIHJldHVybiBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcnJheUxpa2UpO1xufTtcblxuZXhwb3J0IGNvbnN0ICQgPSAoc2VsZWN0b3IsIGNvbnRleHQgPSBkb2N1bWVudCkgPT4gKFxuICB0b0FycmF5KGNvbnRleHQucXVlcnlTZWxlY3RvckFsbC5jYWxsKGNvbnRleHQsIHNlbGVjdG9yKSlcbik7XG5cbmV4cG9ydCBjb25zdCBzZWxlY3RvciA9IChibG9jaywgZWxlbSwgbW9kTmFtZSwgbW9kVmFsKSA9PiAoXG4gIGAke2Jsb2NrfV9fJHtlbGVtfSR7bW9kTmFtZSA/IChtb2RWYWwgPyBgXyR7bW9kTmFtZX1fJHttb2RWYWx9YCA6IGBfJHttb2ROYW1lfWApIDogJyd9YFxuKTtcblxuZXhwb3J0IGNvbnN0IGJ1aWxkQ2xhc3MgPSAoLi4uYXJncykgPT4gYC4ke3NlbGVjdG9yKC4uLmFyZ3MpfWA7XG5cbmV4cG9ydCBjb25zdCBnZXRQYXJlbnRzID0gKHRhcmdldCwgcGFyZW50ID0gZG9jdW1lbnQpID0+IHtcbiAgY29uc3QgcGFyZW50cyA9IFtdO1xuICBsZXQgcCA9IHRhcmdldC5wYXJlbnROb2RlO1xuXG4gIHdoaWxlIChwICE9PSBwYXJlbnQpIHtcbiAgICBsZXQgbyA9IHA7XG4gICAgcGFyZW50cy5wdXNoKG8pO1xuICAgIHAgPSBvLnBhcmVudE5vZGU7XG4gIH1cbiAgcGFyZW50cy5wdXNoKHBhcmVudCk7XG5cbiAgcmV0dXJuIHBhcmVudHM7XG59O1xuXG5leHBvcnQgY2xhc3MgQkVNIGV4dGVuZHMgbnVsbCB7XG4gIGNvbnN0cnVjdG9yKG5hbWUsIG5vZGUpIHtcbiAgICBzdXBlcigpO1xuICAgIHRoaXMubm9kZSA9IG5vZGU7XG4gICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgfVxuXG4gIGVsZW0obmFtZSwgbW9kTmFtZSwgbW9kVmFsKSB7XG4gICAgcmV0dXJuIHRoaXMubm9kZS5xdWVyeVNlbGVjdG9yKGJ1aWxkQ2xhc3ModGhpcy5uYW1lLCBuYW1lLCBtb2ROYW1lLCBtb2RWYWwpKTtcbiAgfVxuXG4gIGVsZW1zKG5hbWUsIG1vZE5hbWUsIG1vZFZhbCkge1xuICAgIHJldHVybiAkKGJ1aWxkQ2xhc3ModGhpcy5uYW1lLCBuYW1lLCBtb2ROYW1lLCBtb2RWYWwpLCB0aGlzLm5vZGUpLmZpbHRlcihub2RlID0+IHtcbiAgICAgIGNvbnN0ICRwYXJlbnRzID0gZ2V0UGFyZW50cyhub2RlLCB0aGlzLm5vZGUpO1xuICAgICAgY29uc3QgJGZpcnN0QmxvY2sgPSAkcGFyZW50cy5maWx0ZXIocGFyZW50ID0+IHBhcmVudC5jbGFzc0xpc3QuY29udGFpbnModGhpcy5uYW1lKSlbMF07XG5cbiAgICAgIHJldHVybiAkZmlyc3RCbG9jayA9PT0gdGhpcy5ub2RlO1xuICAgIH0pO1xuICB9XG5cbiAgc2V0TW9kKGVsZW0sIGVsZW1OYW1lLCBtb2ROYW1lLCBtb2RWYWx1ZSkge1xuICAgIHRvQXJyYXkoZWxlbSkuZm9yRWFjaChub2RlID0+IChcbiAgICAgIG5vZGUuY2xhc3NMaXN0LmFkZChzZWxlY3Rvcih0aGlzLm5hbWUsIGVsZW1OYW1lLCBtb2ROYW1lLCBtb2RWYWx1ZSkpXG4gICAgKSk7XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIGRlbE1vZChlbGVtLCBlbGVtTmFtZSwgbW9kTmFtZSkge1xuICAgIHRvQXJyYXkoZWxlbSkuZm9yRWFjaChub2RlID0+IChcbiAgICAgIG5vZGUuY2xhc3NMaXN0LnJlbW92ZShzZWxlY3Rvcih0aGlzLm5hbWUsIGVsZW1OYW1lLCBtb2ROYW1lKSlcbiAgICApKTtcblxuICAgIHJldHVybiB0aGlzO1xuICB9XG59IiwiaW1wb3J0IHsgJCB9IGZyb20gJy4vZG9tJztcbmltcG9ydCBUYWJzIGZyb20gJy4vdGFicyc7XG5cbiQoJy50YWJzJykuZm9yRWFjaChub2RlID0+IG5ldyBUYWJzKG5vZGUsIHsgYXV0b0hlaWdodDogdHJ1ZSB9KSk7IiwiaW1wb3J0IHsgJCwgQkVNLCBidWlsZENsYXNzLCBzZWxlY3RvciB9IGZyb20gJy4vZG9tJztcblxuY29uc3QgUEFORUxfQU5JTUFUSU9OX09QVElPTlMgPSB7XG4gIGR1cmF0aW9uOiAzMDAsXG4gIGZpbGw6ICdmb3J3YXJkcycsXG4gIGVhc2luZzogJ2Vhc2UtaW4tb3V0J1xufTtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgVGFicyBleHRlbmRzIEJFTSB7XG4gIGNvbnN0cnVjdG9yKG5vZGUsIHsgYXV0b0hlaWdodCA9IGZhbHNlIH0gPSB7fSkge1xuICAgIHN1cGVyKCd0YWJzJywgbm9kZSk7XG5cbiAgICB0aGlzLiRjb250cm9scyA9IHRoaXMuZWxlbXMoJ25hdi1pdGVtJyk7XG4gICAgdGhpcy4kc2xpZGVzID0gdGhpcy5lbGVtcygnc2xpZGUnKTtcblxuICAgIHRoaXMuJG1hcmtlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIHRoaXMuJG1hcmtlci5jbGFzc0xpc3QuYWRkKHNlbGVjdG9yKHRoaXMubmFtZSwgJ21hcmtlcicpKTtcblxuICAgIHRoaXMuZWxlbSgnaGVhZGVyJykuYXBwZW5kQ2hpbGQodGhpcy4kbWFya2VyKTtcblxuICAgIGlmIChhdXRvSGVpZ2h0KSB7XG4gICAgICBjb25zdCBtYXhIZWlnaHQgPSB0aGlzLiRzbGlkZXMucmVkdWNlKCh0YXJnZXQsIGl0ZW0pID0+IHtcbiAgICAgICAgaWYgKGl0ZW0uY2xpZW50SGVpZ2h0ID4gdGFyZ2V0KSB7XG4gICAgICAgICAgdGFyZ2V0ID0gaXRlbS5jbGllbnRIZWlnaHQ7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGFyZ2V0O1xuICAgICAgfSwgMCk7XG5cbiAgICAgIHRoaXMuZWxlbSgnbWFpbicpLnN0eWxlLmhlaWdodCA9IGAke21heEhlaWdodH1weGA7XG4gICAgfVxuXG4gICAgdGhpcy5jdXJyZW50SW5kZXggPSB0aGlzLmdldEluZGV4QnlFbGVtKHRoaXMuZWxlbSgnbmF2LWl0ZW0nLCAnYWN0aXZlJykpO1xuXG4gICAgdGhpcy5lbGVtKCduYXYnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XG4gICAgICBjb25zdCAkZWxlbSA9IGUudGFyZ2V0LmNsb3Nlc3QoYnVpbGRDbGFzcyh0aGlzLm5hbWUsICduYXYtaXRlbScpKTtcblxuICAgICAgaWYgKCEkZWxlbSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHRvSW5kZXggPSB0aGlzLmdldEluZGV4QnlFbGVtKCRlbGVtKTtcblxuICAgICAgaWYgKHRvSW5kZXggPT09IHRoaXMuY3VycmVudEluZGV4KSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgdGhpcy5kZWxNb2QodGhpcy5lbGVtKCduYXYtaXRlbScsICdhY3RpdmUnKSwgJ25hdi1pdGVtJywgJ2FjdGl2ZScpO1xuICAgICAgdGhpcy5zZXRNb2QoJGVsZW0sICduYXYtaXRlbScsICdhY3RpdmUnKTtcblxuICAgICAgdGhpcy5hbmltYXRlUGFuZWxzKHRvSW5kZXgpO1xuICAgICAgdGhpcy5hbmltYXRlTWFya2VyKHRvSW5kZXgpO1xuXG4gICAgICB0aGlzLmN1cnJlbnRJbmRleCA9IHRvSW5kZXg7XG4gICAgfSwgZmFsc2UpO1xuXG4gICAgdGhpcy5zZXRNb2QodGhpcy5lbGVtKCduYXYtaXRlbScsICdhY3RpdmUnKSwgJ25hdi1pdGVtJywgJ21hcmtlcicpO1xuICB9XG5cbiAgYW5pbWF0ZVBhbmVscyhpbmRleCkge1xuICAgIGNvbnN0IGN1cnJlbnQgPSB0aGlzLmN1cnJlbnRJbmRleDtcbiAgICBjb25zdCBpc05leHQgPSBjdXJyZW50IDwgaW5kZXg7XG5cbiAgICAoY3VycmVudCAhPT0gdW5kZWZpbmVkKSAmJiB0aGlzLiRzbGlkZXNbY3VycmVudF0uYW5pbWF0ZShbXG4gICAgICB7IHRyYW5zZm9ybTogJ3RyYW5zbGF0ZVgoMCknLCBvcGFjaXR5OiAxIH0sXG4gICAgICB7IHRyYW5zZm9ybTogYHRyYW5zbGF0ZVgoJHtpc05leHQgPyAnLScgOiAnJ30xMDAlKWAsIG9wYWNpdHk6IDAgfVxuICAgIF0sIFBBTkVMX0FOSU1BVElPTl9PUFRJT05TKTtcblxuICAgIHRoaXMuJHNsaWRlc1tpbmRleF0uYW5pbWF0ZShbXG4gICAgICB7IHRyYW5zZm9ybTogYHRyYW5zbGF0ZVgoJHtpc05leHQgPyAnJyA6ICctJ30xMDAlKWAsIG9wYWNpdHk6IDAgfSxcbiAgICAgIHsgdHJhbnNmb3JtOiAndHJhbnNsYXRlWCgwKScsIG9wYWNpdHk6IDEgfVxuICAgIF0sIFBBTkVMX0FOSU1BVElPTl9PUFRJT05TKTtcbiAgfVxuXG4gIGFuaW1hdGVNYXJrZXIoaW5kZXgpIHtcbiAgICBjb25zdCBjdXJyZW50ID0ge1xuICAgICAgbGVmdDogdGhpcy4kY29udHJvbHNbdGhpcy5jdXJyZW50SW5kZXhdLm9mZnNldExlZnQsXG4gICAgICB3aWR0aDogdGhpcy4kY29udHJvbHNbdGhpcy5jdXJyZW50SW5kZXhdLmNsaWVudFdpZHRoXG4gICAgfTtcblxuICAgIGNvbnN0IGxlZnQgPSB0aGlzLiRjb250cm9sc1tpbmRleF0ub2Zmc2V0TGVmdDtcbiAgICBjb25zdCB3aWR0aCA9IHRoaXMuJGNvbnRyb2xzW2luZGV4XS5jbGllbnRXaWR0aDtcblxuICAgIGNvbnN0IHBsYXllciA9IHRoaXMuJG1hcmtlci5hbmltYXRlKFtcbiAgICAgIHtcbiAgICAgICAgdHJhbnNmb3JtOiBgdHJhbnNsYXRlWCgke2N1cnJlbnQubGVmdH1weClgLFxuICAgICAgICB3aWR0aDogYCR7Y3VycmVudC53aWR0aH1weGBcbiAgICAgIH0sIHtcbiAgICAgICAgdHJhbnNmb3JtOiBgdHJhbnNsYXRlWCgke2xlZnR9cHgpYCxcbiAgICAgICAgd2lkdGg6IGAke3dpZHRofXB4YFxuICAgICAgfVxuICAgIF0sIHsuLi5QQU5FTF9BTklNQVRJT05fT1BUSU9OUyB9KTtcblxuICAgIHBsYXllci5vbmZpbmlzaCA9ICgpID0+IHtcbiAgICAgIHRoaXMuc2V0TW9kKHRoaXMuJGNvbnRyb2xzW2luZGV4XSwgJ25hdi1pdGVtJywgJ21hcmtlcicpO1xuICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHBsYXllci5jYW5jZWwoKSk7XG4gICAgfTtcblxuICAgIHRoaXMuZGVsTW9kKHRoaXMuJGNvbnRyb2xzW3RoaXMuY3VycmVudEluZGV4XSwgJ25hdi1pdGVtJywgJ21hcmtlcicpXG4gIH1cblxuICBnZXRJbmRleEJ5RWxlbShlbGVtKSB7XG4gICAgbGV0IGluZGV4ID0gLTE7XG5cbiAgICB0aGlzLiRjb250cm9scy5zb21lKChub2RlLCBpKSA9PiB7XG4gICAgICBpZiAobm9kZSA9PT0gZWxlbSkge1xuICAgICAgICBpbmRleCA9IGk7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIGluZGV4O1xuICB9XG59Il19
