(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var toArray = exports.toArray = function toArray(arrayLike) {
  if (Array.isArray(arrayLike)) {
    return arrayLike;
  }

  if (arrayLike instanceof Node) {
    return [arrayLike];
  }

  return Array.prototype.slice.call(arrayLike);
};

var $ = exports.$ = function $(selector) {
  var context = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : document;
  return toArray(context.querySelectorAll.call(context, selector));
};

var selector = exports.selector = function selector(block, elem, modName, modVal) {
  return block + '__' + elem + (modName ? modVal ? '_' + modName + '_' + modVal : '_' + modName : '');
};

var buildClass = exports.buildClass = function buildClass() {
  return '.' + selector.apply(undefined, arguments);
};

var getParents = exports.getParents = function getParents(target) {
  var parent = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : document;

  var parents = [];
  var p = target.parentNode;

  while (p !== parent) {
    var o = p;
    parents.push(o);
    p = o.parentNode;
  }
  parents.push(parent);

  return parents;
};

var BEM = exports.BEM = function (_ref) {
  _inherits(BEM, _ref);

  function BEM(name, node) {
    _classCallCheck(this, BEM);

    var _this = _possibleConstructorReturn(this, (BEM.__proto__ || Object.getPrototypeOf(BEM)).call(this));

    _this.node = node;
    _this.name = name;
    return _this;
  }

  _createClass(BEM, [{
    key: 'elem',
    value: function elem(name, modName, modVal) {
      return this.node.querySelector(buildClass(this.name, name, modName, modVal));
    }
  }, {
    key: 'elems',
    value: function elems(name, modName, modVal) {
      var _this2 = this;

      return $(buildClass(this.name, name, modName, modVal), this.node).filter(function (node) {
        var $parents = getParents(node, _this2.node);
        var $firstBlock = $parents.filter(function (parent) {
          return parent.classList.contains(_this2.name);
        })[0];

        return $firstBlock === _this2.node;
      });
    }
  }, {
    key: 'setMod',
    value: function setMod(elem, elemName, modName, modValue) {
      var _this3 = this;

      toArray(elem).forEach(function (node) {
        return node.classList.add(selector(_this3.name, elemName, modName, modValue));
      });

      return this;
    }
  }, {
    key: 'delMod',
    value: function delMod(elem, elemName, modName) {
      var _this4 = this;

      toArray(elem).forEach(function (node) {
        return node.classList.remove(selector(_this4.name, elemName, modName));
      });

      return this;
    }
  }]);

  return BEM;
}(null);

},{}],2:[function(require,module,exports){
'use strict';

var _dom = require('./dom');

var _tabs = require('./tabs');

var _tabs2 = _interopRequireDefault(_tabs);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

(0, _dom.$)('.tabs').forEach(function (node) {
  return new _tabs2.default(node);
});

},{"./dom":1,"./tabs":3}],3:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _dom = require('./dom');

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var PANEL_ANIMATION_OPTIONS = {
  duration: 300,
  fill: 'forwards',
  easing: 'ease-in-out'
};

var Tabs = function (_BEM) {
  _inherits(Tabs, _BEM);

  function Tabs(node) {
    var _ref = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},
        _ref$autoHeight = _ref.autoHeight,
        autoHeight = _ref$autoHeight === undefined ? false : _ref$autoHeight;

    _classCallCheck(this, Tabs);

    var _this = _possibleConstructorReturn(this, (Tabs.__proto__ || Object.getPrototypeOf(Tabs)).call(this, 'tabs', node));

    _this.$controls = _this.elems('nav-item');
    _this.$slides = _this.elems('slide');

    _this.$marker = document.createElement('div');
    _this.$marker.classList.add((0, _dom.selector)(_this.name, 'marker'));
    _this.elem('header').appendChild(_this.$marker);

    if (autoHeight) {
      var maxHeight = _this.$slides.reduce(function (target, item) {
        if (item.clientHeight > target) {
          target = item.clientHeight;
        }

        return target;
      }, 0);

      _this.elem('main').style.height = maxHeight + 'px';
    }

    _this.currentIndex = _this.getIndexByElem(_this.elem('nav-item', 'active'));

    _this.elem('nav').addEventListener('click', function (e) {
      var $elem = e.target.closest((0, _dom.buildClass)(_this.name, 'nav-item'));

      if (!$elem) {
        return;
      }

      var toIndex = _this.getIndexByElem($elem);

      if (toIndex === _this.currentIndex) {
        return;
      }

      _this.delMod(_this.elem('nav-item', 'active'), 'nav-item', 'active');
      _this.setMod($elem, 'nav-item', 'active');

      _this.animatePanels(toIndex);
      _this.animateMarker(toIndex);

      _this.currentIndex = toIndex;
    }, false);

    _this.setMod(_this.elem('nav-item', 'active'), 'nav-item', 'marker');
    return _this;
  }

  _createClass(Tabs, [{
    key: 'animatePanels',
    value: function animatePanels(index) {
      var current = this.currentIndex;
      var isNext = current < index;

      current !== undefined && this.$slides[current].animate([{ transform: 'translateX(0)', opacity: 1 }, { transform: 'translateX(' + (isNext ? '-' : '') + '100%)', opacity: 0 }], PANEL_ANIMATION_OPTIONS);

      this.$slides[index].animate([{ transform: 'translateX(' + (isNext ? '' : '-') + '100%)', opacity: 0 }, { transform: 'translateX(0)', opacity: 1 }], PANEL_ANIMATION_OPTIONS);
    }
  }, {
    key: 'animateMarker',
    value: function animateMarker(index) {
      var _this2 = this;

      var current = {
        left: this.$controls[this.currentIndex].offsetLeft,
        width: this.$controls[this.currentIndex].clientWidth
      };

      var left = this.$controls[index].offsetLeft;
      var width = this.$controls[index].clientWidth;

      var player = this.$marker.animate([{
        transform: 'translateX(' + current.left + 'px)',
        width: current.width + 'px'
      }, {
        transform: 'translateX(' + left + 'px)',
        width: width + 'px'
      }], _extends({}, PANEL_ANIMATION_OPTIONS));

      player.onfinish = function () {
        _this2.setMod(_this2.$controls[index], 'nav-item', 'marker');
        requestAnimationFrame(function () {
          return player.cancel();
        });
      };

      this.delMod(this.$controls[this.currentIndex], 'nav-item', 'marker');
    }
  }, {
    key: 'getIndexByElem',
    value: function getIndexByElem(elem) {
      var index = -1;

      this.$controls.some(function (node, i) {
        if (node === elem) {
          index = i;
          return true;
        }
      });

      return index;
    }
  }]);

  return Tabs;
}(_dom.BEM);

exports.default = Tabs;
module.exports = exports['default'];

},{"./dom":1}]},{},[2])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvc2NyaXB0cy9kb20uanMiLCJzcmMvc2NyaXB0cy9tYWluLWpvaW4uanMiLCJzcmMvc2NyaXB0cy90YWJzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7Ozs7Ozs7QUNBTyxJQUFNLDRCQUFVLFNBQVYsT0FBVSxZQUFhO0FBQ2xDLE1BQUksTUFBTSxPQUFOLENBQWMsU0FBZCxDQUFKLEVBQThCO0FBQzVCLFdBQU8sU0FBUDtBQUNEOztBQUVELE1BQUkscUJBQXFCLElBQXpCLEVBQStCO0FBQzdCLFdBQU8sQ0FBQyxTQUFELENBQVA7QUFDRDs7QUFFRCxTQUFPLE1BQU0sU0FBTixDQUFnQixLQUFoQixDQUFzQixJQUF0QixDQUEyQixTQUEzQixDQUFQO0FBQ0QsQ0FWTTs7QUFZQSxJQUFNLGdCQUFJLFNBQUosQ0FBSSxDQUFDLFFBQUQ7QUFBQSxNQUFXLE9BQVgsdUVBQXFCLFFBQXJCO0FBQUEsU0FDZixRQUFRLFFBQVEsZ0JBQVIsQ0FBeUIsSUFBekIsQ0FBOEIsT0FBOUIsRUFBdUMsUUFBdkMsQ0FBUixDQURlO0FBQUEsQ0FBVjs7QUFJQSxJQUFNLDhCQUFXLFNBQVgsUUFBVyxDQUFDLEtBQUQsRUFBUSxJQUFSLEVBQWMsT0FBZCxFQUF1QixNQUF2QjtBQUFBLFNBQ25CLEtBRG1CLFVBQ1QsSUFEUyxJQUNGLFVBQVcsZUFBYSxPQUFiLFNBQXdCLE1BQXhCLFNBQXVDLE9BQWxELEdBQStELEVBRDdEO0FBQUEsQ0FBakI7O0FBSUEsSUFBTSxrQ0FBYSxTQUFiLFVBQWE7QUFBQSxlQUFpQixvQ0FBakI7QUFBQSxDQUFuQjs7QUFFQSxJQUFNLGtDQUFhLFNBQWIsVUFBYSxDQUFDLE1BQUQsRUFBK0I7QUFBQSxNQUF0QixNQUFzQix1RUFBYixRQUFhOztBQUN2RCxNQUFNLFVBQVUsRUFBaEI7QUFDQSxNQUFJLElBQUksT0FBTyxVQUFmOztBQUVBLFNBQU8s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QixZQUFNO0FBQ3RCLGVBQUssTUFBTCxDQUFZLE9BQUssU0FBTCxDQUFlLEtBQWYsQ0FBWixFQUFtQyxVQUFuQyxFQUErQyxRQUEvQztBQUNBLDhCQUFzQjtBQUFBLGlCQUFNLE9BQU8sTUFBUCxFQUFOO0FBQUEsU0FBdEI7QUFDRCxPQUhEOztBQUtBLFdBQUssTUFBTCxDQUFZLEtBQUssU0FBTCxDQUFlLEtBQUssWUFBcEIsQ0FBWixFQUErQyxVQUEvQyxFQUEyRCxRQUEzRDtBQUNEOzs7bUNBRWMsSSxFQUFNO0FBQ25CLFVBQUksUUFBUSxDQUFDLENBQWI7O0FBRUEsV0FBSyxTQUFMLENBQWUsSUFBZixDQUFvQixVQUFDLElBQUQsRUFBTyxDQUFQLEVBQWE7QUFDL0IsWUFBSSxTQUFTLElBQWIsRUFBbUI7QUFDakIsa0JBQVEsQ0FBUjtBQUNBLGlCQUFPLElBQVA7QUFDRDtBQUNGLE9BTEQ7O0FBT0EsYUFBTyxLQUFQO0FBQ0Q7Ozs7OztrQkF2R2tCLEkiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiZXhwb3J0IGNvbnN0IHRvQXJyYXkgPSBhcnJheUxpa2UgPT4ge1xuICBpZiAoQXJyYXkuaXNBcnJheShhcnJheUxpa2UpKSB7XG4gICAgcmV0dXJuIGFycmF5TGlrZTtcbiAgfVxuXG4gIGlmIChhcnJheUxpa2UgaW5zdGFuY2VvZiBOb2RlKSB7XG4gICAgcmV0dXJuIFthcnJheUxpa2VdO1xuICB9XG5cbiAgcmV0dXJuIEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFycmF5TGlrZSk7XG59O1xuXG5leHBvcnQgY29uc3QgJCA9IChzZWxlY3RvciwgY29udGV4dCA9IGRvY3VtZW50KSA9PiAoXG4gIHRvQXJyYXkoY29udGV4dC5xdWVyeVNlbGVjdG9yQWxsLmNhbGwoY29udGV4dCwgc2VsZWN0b3IpKVxuKTtcblxuZXhwb3J0IGNvbnN0IHNlbGVjdG9yID0gKGJsb2NrLCBlbGVtLCBtb2ROYW1lLCBtb2RWYWwpID0+IChcbiAgYCR7YmxvY2t9X18ke2VsZW19JHttb2ROYW1lID8gKG1vZFZhbCA/IGBfJHttb2ROYW1lfV8ke21vZFZhbH1gIDogYF8ke21vZE5hbWV9YCkgOiAnJ31gXG4pO1xuXG5leHBvcnQgY29uc3QgYnVpbGRDbGFzcyA9ICguLi5hcmdzKSA9PiBgLiR7c2VsZWN0b3IoLi4uYXJncyl9YDtcblxuZXhwb3J0IGNvbnN0IGdldFBhcmVudHMgPSAodGFyZ2V0LCBwYXJlbnQgPSBkb2N1bWVudCkgPT4ge1xuICBjb25zdCBwYXJlbnRzID0gW107XG4gIGxldCBwID0gdGFyZ2V0LnBhcmVudE5vZGU7XG5cbiAgd2hpbGUgKHAgIT09IHBhcmVudCkge1xuICAgIGxldCBvID0gcDtcbiAgICBwYXJlbnRzLnB1c2gobyk7XG4gICAgcCA9IG8ucGFyZW50Tm9kZTtcbiAgfVxuICBwYXJlbnRzLnB1c2gocGFyZW50KTtcblxuICByZXR1cm4gcGFyZW50cztcbn07XG5cbmV4cG9ydCBjbGFzcyBCRU0gZXh0ZW5kcyBudWxsIHtcbiAgY29uc3RydWN0b3IobmFtZSwgbm9kZSkge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy5ub2RlID0gbm9kZTtcbiAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICB9XG5cbiAgZWxlbShuYW1lLCBtb2ROYW1lLCBtb2RWYWwpIHtcbiAgICByZXR1cm4gdGhpcy5ub2RlLnF1ZXJ5U2VsZWN0b3IoYnVpbGRDbGFzcyh0aGlzLm5hbWUsIG5hbWUsIG1vZE5hbWUsIG1vZFZhbCkpO1xuICB9XG5cbiAgZWxlbXMobmFtZSwgbW9kTmFtZSwgbW9kVmFsKSB7XG4gICAgcmV0dXJuICQoYnVpbGRDbGFzcyh0aGlzLm5hbWUsIG5hbWUsIG1vZE5hbWUsIG1vZFZhbCksIHRoaXMubm9kZSkuZmlsdGVyKG5vZGUgPT4ge1xuICAgICAgY29uc3QgJHBhcmVudHMgPSBnZXRQYXJlbnRzKG5vZGUsIHRoaXMubm9kZSk7XG4gICAgICBjb25zdCAkZmlyc3RCbG9jayA9ICRwYXJlbnRzLmZpbHRlcihwYXJlbnQgPT4gcGFyZW50LmNsYXNzTGlzdC5jb250YWlucyh0aGlzLm5hbWUpKVswXTtcblxuICAgICAgcmV0dXJuICRmaXJzdEJsb2NrID09PSB0aGlzLm5vZGU7XG4gICAgfSk7XG4gIH1cblxuICBzZXRNb2QoZWxlbSwgZWxlbU5hbWUsIG1vZE5hbWUsIG1vZFZhbHVlKSB7XG4gICAgdG9BcnJheShlbGVtKS5mb3JFYWNoKG5vZGUgPT4gKFxuICAgICAgbm9kZS5jbGFzc0xpc3QuYWRkKHNlbGVjdG9yKHRoaXMubmFtZSwgZWxlbU5hbWUsIG1vZE5hbWUsIG1vZFZhbHVlKSlcbiAgICApKTtcblxuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgZGVsTW9kKGVsZW0sIGVsZW1OYW1lLCBtb2ROYW1lKSB7XG4gICAgdG9BcnJheShlbGVtKS5mb3JFYWNoKG5vZGUgPT4gKFxuICAgICAgbm9kZS5jbGFzc0xpc3QucmVtb3ZlKHNlbGVjdG9yKHRoaXMubmFtZSwgZWxlbU5hbWUsIG1vZE5hbWUpKVxuICAgICkpO1xuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cbn0iLCJpbXBvcnQgeyAkIH0gZnJvbSAnLi9kb20nO1xuaW1wb3J0IFRhYnMgZnJvbSAnLi90YWJzJztcblxuJCgnLnRhYnMnKS5mb3JFYWNoKG5vZGUgPT4gbmV3IFRhYnMobm9kZSkpOyIsImltcG9ydCB7ICQsIEJFTSwgYnVpbGRDbGFzcywgc2VsZWN0b3IgfSBmcm9tICcuL2RvbSc7XG5cbmNvbnN0IFBBTkVMX0FOSU1BVElPTl9PUFRJT05TID0ge1xuICBkdXJhdGlvbjogMzAwLFxuICBmaWxsOiAnZm9yd2FyZHMnLFxuICBlYXNpbmc6ICdlYXNlLWluLW91dCdcbn07XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFRhYnMgZXh0ZW5kcyBCRU0ge1xuICBjb25zdHJ1Y3Rvcihub2RlLCB7IGF1dG9IZWlnaHQgPSBmYWxzZSB9ID0ge30pIHtcbiAgICBzdXBlcigndGFicycsIG5vZGUpO1xuXG4gICAgdGhpcy4kY29udHJvbHMgPSB0aGlzLmVsZW1zKCduYXYtaXRlbScpO1xuICAgIHRoaXMuJHNsaWRlcyA9IHRoaXMuZWxlbXMoJ3NsaWRlJyk7XG5cbiAgICB0aGlzLiRtYXJrZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICB0aGlzLiRtYXJrZXIuY2xhc3NMaXN0LmFkZChzZWxlY3Rvcih0aGlzLm5hbWUsICdtYXJrZXInKSk7XG4gICAgdGhpcy5lbGVtKCdoZWFkZXInKS5hcHBlbmRDaGlsZCh0aGlzLiRtYXJrZXIpO1xuXG4gICAgaWYgKGF1dG9IZWlnaHQpIHtcbiAgICAgIGNvbnN0IG1heEhlaWdodCA9IHRoaXMuJHNsaWRlcy5yZWR1Y2UoKHRhcmdldCwgaXRlbSkgPT4ge1xuICAgICAgICBpZiAoaXRlbS5jbGllbnRIZWlnaHQgPiB0YXJnZXQpIHtcbiAgICAgICAgICB0YXJnZXQgPSBpdGVtLmNsaWVudEhlaWdodDtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0YXJnZXQ7XG4gICAgICB9LCAwKTtcblxuICAgICAgdGhpcy5lbGVtKCdtYWluJykuc3R5bGUuaGVpZ2h0ID0gYCR7bWF4SGVpZ2h0fXB4YDtcbiAgICB9XG5cbiAgICB0aGlzLmN1cnJlbnRJbmRleCA9IHRoaXMuZ2V0SW5kZXhCeUVsZW0odGhpcy5lbGVtKCduYXYtaXRlbScsICdhY3RpdmUnKSk7XG5cbiAgICB0aGlzLmVsZW0oJ25hdicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcbiAgICAgIGNvbnN0ICRlbGVtID0gZS50YXJnZXQuY2xvc2VzdChidWlsZENsYXNzKHRoaXMubmFtZSwgJ25hdi1pdGVtJykpO1xuXG4gICAgICBpZiAoISRlbGVtKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgY29uc3QgdG9JbmRleCA9IHRoaXMuZ2V0SW5kZXhCeUVsZW0oJGVsZW0pO1xuXG4gICAgICBpZiAodG9JbmRleCA9PT0gdGhpcy5jdXJyZW50SW5kZXgpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICB0aGlzLmRlbE1vZCh0aGlzLmVsZW0oJ25hdi1pdGVtJywgJ2FjdGl2ZScpLCAnbmF2LWl0ZW0nLCAnYWN0aXZlJyk7XG4gICAgICB0aGlzLnNldE1vZCgkZWxlbSwgJ25hdi1pdGVtJywgJ2FjdGl2ZScpO1xuXG4gICAgICB0aGlzLmFuaW1hdGVQYW5lbHModG9JbmRleCk7XG4gICAgICB0aGlzLmFuaW1hdGVNYXJrZXIodG9JbmRleCk7XG5cbiAgICAgIHRoaXMuY3VycmVudEluZGV4ID0gdG9JbmRleDtcbiAgICB9LCBmYWxzZSk7XG5cbiAgICB0aGlzLnNldE1vZCh0aGlzLmVsZW0oJ25hdi1pdGVtJywgJ2FjdGl2ZScpLCAnbmF2LWl0ZW0nLCAnbWFya2VyJyk7XG4gIH1cblxuICBhbmltYXRlUGFuZWxzKGluZGV4KSB7XG4gICAgY29uc3QgY3VycmVudCA9IHRoaXMuY3VycmVudEluZGV4O1xuICAgIGNvbnN0IGlzTmV4dCA9IGN1cnJlbnQgPCBpbmRleDtcblxuICAgIChjdXJyZW50ICE9PSB1bmRlZmluZWQpICYmIHRoaXMuJHNsaWRlc1tjdXJyZW50XS5hbmltYXRlKFtcbiAgICAgIHsgdHJhbnNmb3JtOiAndHJhbnNsYXRlWCgwKScsIG9wYWNpdHk6IDEgfSxcbiAgICAgIHsgdHJhbnNmb3JtOiBgdHJhbnNsYXRlWCgke2lzTmV4dCA/ICctJyA6ICcnfTEwMCUpYCwgb3BhY2l0eTogMCB9XG4gICAgXSwgUEFORUxfQU5JTUFUSU9OX09QVElPTlMpO1xuXG4gICAgdGhpcy4kc2xpZGVzW2luZGV4XS5hbmltYXRlKFtcbiAgICAgIHsgdHJhbnNmb3JtOiBgdHJhbnNsYXRlWCgke2lzTmV4dCA/ICcnIDogJy0nfTEwMCUpYCwgb3BhY2l0eTogMCB9LFxuICAgICAgeyB0cmFuc2Zvcm06ICd0cmFuc2xhdGVYKDApJywgb3BhY2l0eTogMSB9XG4gICAgXSwgUEFORUxfQU5JTUFUSU9OX09QVElPTlMpO1xuICB9XG5cbiAgYW5pbWF0ZU1hcmtlcihpbmRleCkge1xuICAgIGNvbnN0IGN1cnJlbnQgPSB7XG4gICAgICBsZWZ0OiB0aGlzLiRjb250cm9sc1t0aGlzLmN1cnJlbnRJbmRleF0ub2Zmc2V0TGVmdCxcbiAgICAgIHdpZHRoOiB0aGlzLiRjb250cm9sc1t0aGlzLmN1cnJlbnRJbmRleF0uY2xpZW50V2lkdGhcbiAgICB9O1xuXG4gICAgY29uc3QgbGVmdCA9IHRoaXMuJGNvbnRyb2xzW2luZGV4XS5vZmZzZXRMZWZ0O1xuICAgIGNvbnN0IHdpZHRoID0gdGhpcy4kY29udHJvbHNbaW5kZXhdLmNsaWVudFdpZHRoO1xuXG4gICAgY29uc3QgcGxheWVyID0gdGhpcy4kbWFya2VyLmFuaW1hdGUoW1xuICAgICAge1xuICAgICAgICB0cmFuc2Zvcm06IGB0cmFuc2xhdGVYKCR7Y3VycmVudC5sZWZ0fXB4KWAsXG4gICAgICAgIHdpZHRoOiBgJHtjdXJyZW50LndpZHRofXB4YFxuICAgICAgfSwge1xuICAgICAgICB0cmFuc2Zvcm06IGB0cmFuc2xhdGVYKCR7bGVmdH1weClgLFxuICAgICAgICB3aWR0aDogYCR7d2lkdGh9cHhgXG4gICAgICB9XG4gICAgXSwgey4uLlBBTkVMX0FOSU1BVElPTl9PUFRJT05TIH0pO1xuXG4gICAgcGxheWVyLm9uZmluaXNoID0gKCkgPT4ge1xuICAgICAgdGhpcy5zZXRNb2QodGhpcy4kY29udHJvbHNbaW5kZXhdLCAnbmF2LWl0ZW0nLCAnbWFya2VyJyk7XG4gICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4gcGxheWVyLmNhbmNlbCgpKTtcbiAgICB9O1xuXG4gICAgdGhpcy5kZWxNb2QodGhpcy4kY29udHJvbHNbdGhpcy5jdXJyZW50SW5kZXhdLCAnbmF2LWl0ZW0nLCAnbWFya2VyJylcbiAgfVxuXG4gIGdldEluZGV4QnlFbGVtKGVsZW0pIHtcbiAgICBsZXQgaW5kZXggPSAtMTtcblxuICAgIHRoaXMuJGNvbnRyb2xzLnNvbWUoKG5vZGUsIGkpID0+IHtcbiAgICAgIGlmIChub2RlID09PSBlbGVtKSB7XG4gICAgICAgIGluZGV4ID0gaTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICByZXR1cm4gaW5kZXg7XG4gIH1cbn0iXX0=
