language: node_js
services:
- docker
cache:
  directories:
  - ~/.nvm
  - node_modules
notifications:
  slack: 
    rooms:
      - secure: "aT8bVV0DzMS+TkH+BBN5F8Hq3/TinuD1okvizQIKdjAuv7YbBTe2KCjytRf1mmPEq9QU/4sDnt6kk6PWpmz1luePtIBrbYLD/6Nna0NcT3JN22ZtJ01Xkm7NTk9XZxSsMVImO6uamTThD3kZPNayoNFf/CIebbkhDeUT5n2zfLhSxjfA03HStzU496xq/uspZHlBlFpR1W6tYnN37IOpzeBpwo6jCuGs1045fTzemZ1iIl4RLmP/u+7UpAioxnvgSPQI6BDt7j/YNVSBzZFI7WYQ/q2RN45pa/NaKfuklHQ5ZmUQCYpV/xbPHGk59UtML594Y62wFSIXWlLD8u7uDXFlsf6BH5jKcT+QafqH1QJIsi0O8BZJFMYkUnxzDrP42eFeTJjphjEZz+dbAEF9e78XlwwpYZDZwFZqqqfN0QD90N21bbSoiNsXOpFr0GrzHPdKfvnyTPh/BTOY7XJBS9h7+KGzxVrbOPpJ+oP3gTxGD0SA3tkDeEre073fi73AViBdRKwupjikfILqrnhSVYkRRTMO6o3HV25XYG21OUex8fPTgaWoVyyPQy2NKmCR/8M800lIJamn1dhrIAOjAL2skpdeUh5X7lKbxuZvcHs6kRtRZOJzV2QmQYEvF9V9xd4xMZ5aXqx356+P1yWlJaZS2vtlqTLqzXwpcLdPwa4="
    on_success: always
env:
  global:
  - Chart=fe
  - RELEASE_BRANCH="master"
  - DOCKER_HUB_ACCOUNT="edenlabllc"
  - MAIN_BRANCHES="master develop"
  - secure: "BOGGS8LAFb5d+egp0/y9rz5hvz36O7wmHuV5QQDxuhK+/v3dcGTeLckWr6YYjr2dZkGHNH3/SFZ+g1Fh1mDkaLdyO3g1sruSo6pqiAc+yyRpqt+9w4TSI3QiLV3cnJy6jOE3y5SqnsiBBi9ntqWJ3B7j/7UXfW7gyUXII82YN190/pwEH4s90V+kC7mHqD1JDHsT8BSsUIUux5JklJL9Qm/TpCaoBSDNXUd8GtE9NXR4Leeoc8B6kRt6Xpn2xeUf9zBmeWqNv52QYKfLPtssDDgkYyC8RQ3a3O6KtNyCFPQ/HV6L4m5wJZs8Pt/1HjK+6ZUAt4iOPGiqunLaoj6m0LSrmd0JxuV/oIA2IzR3uXGfeD4hfRJztNkYJXn+llabQcouBIdWoLS1cq5sFMFsQrgT+sxRkuwWpG5lDkWrnqn2DnUco72kUnbsUcyauop0XK+XAZkS79JYRBfBbKNTsgOrqzBLyeXnX0rqTk8KMtuGS81X7/TjDTMNXHdzubP30LotVQlvzDnz9yEKMOaInkwRe92dIAQ0vszHMgK0IEJF8mgdVTL9ttQp9IhPytERdv6vcoJpqR7Dt5JbEt4uEbn7jZ0SFtn/yyK3K2xTiFNRkZJtXgW7YLZubEdX2/HwKYJAIZ6Pw/e7Sh9zrtZFvAuW4UlzWe7UkpvIxChxN3I="
  - secure: mnpOySeseQd1l+bvnFeseR7Zq1Dv2n09CngK4JgU7+h50kY72NSyrBlcFg1ctgR8VvoBsGnmio/u8EBH1108KaR4cT8XghrGN+tp4a6HeS0U5RjtNJb546kAc41xlS5Bysn+0Dy4E3DCFTK75qMdHZp2vtbtpgC8m79yDO4YBt+7atFO+zicXwl9MVY30L397NCBRy1/LtAfCxmyAymzYBLwfmh7UoIlnFm/88TvG9x4b0KBAW6ElMdDN6ir0yPcXuM4o+pTcltjHjop6SFeXxYPYNWRugx7RfQQxDCZ4ljTHzjAxdaclkhd7TTgBtNPO4TsnVivOssuyfYMkJSIaEvLSeWalzTmO1bNn4rdGhRU3eP7RCqNWytzCT6/RuVR2dDyYrHqaXa3cuohiibLQHMo9GUOf62JTZ+v/O8dAQ3mj9BmIXQcf5GBBynLIeKN9rrKq4D9LPROaAEFx+zfy1ksZLTuwxYGvPey77KL96AbdLxAFRg1ruRYUH+MlcgrRQENan67Oxso7fgwApdzklW4bzlC2jgybJcjSyvvJSInTFQnlWF/JtixeJdNN9V0gCM49oQXbWOxV0BmUt8nOJ+4/AJ6+me1G05UIvbpPdpA3Uk1I5p/XUblyVvHTUl5LsIHvasqqLgpRUVLs+GwstktIL7bzw3k8tKe8LwUb6M=
node_js:
- 7.5.0
install:
- openssl aes-256-cbc -K $encrypted_57c23f06a696_key -iv $encrypted_57c23f06a696_iv -in eHealth-eef414faa06b.json.enc -out eHealth-eef414faa06b.json -d
- npm install
- bundler install
before_install:
- chmod -R +x bin
script:
- ./bin/version-increment.sh || travis_terminate 1
- ./bin/build.sh || travis_terminate 1
- ./bin/start.sh || travis_terminate 1
- sleep 5
- docker ps
- RUNNING_CONTAINERS=`docker ps | wc -l`; if [ "${RUNNING_CONTAINERS//[[:space:]]/}"
  == "1" ]; then echo "[E] Container is not started\!"; docker logs nhs.portal.web
  --details --since 5h; exit 1; fi;
- sleep 5
- ./bin/ci/push.sh 
- sudo ./bin/deploy.sh || travis_terminate 1
